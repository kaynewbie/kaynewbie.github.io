<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Dart 入门 (译) | Kai的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文列出了 Dart 语言的每个主要功能的用法，从变量和运算符到类库。本文适用于有其他编程语言经验的开发者。想学习更多 Dart 核心库的，请查看此文档。想学习更多语言细节的，请查看此文档。">
<meta name="keywords" content="flutter,dart">
<meta property="og:type" content="article">
<meta property="og:title" content="Dart 入门 (译)">
<meta property="og:url" content="https://kaynewbie.github.io/2019/07/24/A-tour-of-the-dart-language/index.html">
<meta property="og:site_name" content="Kai的博客">
<meta property="og:description" content="本文列出了 Dart 语言的每个主要功能的用法，从变量和运算符到类库。本文适用于有其他编程语言经验的开发者。想学习更多 Dart 核心库的，请查看此文档。想学习更多语言细节的，请查看此文档。">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-07-24T22:53:44.721Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dart 入门 (译)">
<meta name="twitter:description" content="本文列出了 Dart 语言的每个主要功能的用法，从变量和运算符到类库。本文适用于有其他编程语言经验的开发者。想学习更多 Dart 核心库的，请查看此文档。想学习更多语言细节的，请查看此文档。">
  
    <link rel="alternate" href="/atom.xml" title="Kai的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Kai的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://kaynewbie.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-A-tour-of-the-dart-language" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/24/A-tour-of-the-dart-language/" class="article-date">
  <time datetime="2019-07-24T15:33:48.000Z" itemprop="datePublished">2019-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Dart 入门 (译)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文列出了 Dart 语言的每个主要功能的用法，从变量和运算符到类库。本文适用于有其他编程语言经验的开发者。<br>想学习更多 Dart 核心库的，请查看此<a href="https://dart.dev/guides/libraries/library-tour" target="_blank" rel="noopener">文档</a>。想学习更多语言细节的，请查看此<a href="https://dart.dev/guides/language/spec" target="_blank" rel="noopener">文档</a>。</p>
<a id="more"></a>

<p>目录</p>
<ul>
<li><a href="#1-%e4%b8%80%e6%ae%b5%e5%9f%ba%e7%a1%80%e7%9a%84-dart-%e7%a8%8b%e5%ba%8f">1. 一段基础的 Dart 程序</a></li>
<li><a href="#2-%e9%87%8d%e8%a6%81%e6%a6%82%e5%bf%b5">2. 重要概念</a></li>
<li><a href="#3-%e5%85%b3%e9%94%ae%e5%ad%97">3. 关键字</a></li>
<li><a href="#4-%e5%8f%98%e9%87%8f">4. 变量</a><ul>
<li><a href="#41-%e9%bb%98%e8%ae%a4%e5%80%bc">4.1 默认值</a></li>
<li><a href="#42-final-%e5%92%8c-const-%e5%85%b3%e9%94%ae%e5%ad%97">4.2 Final 和 const 关键字</a></li>
</ul>
</li>
<li><a href="#5-%e8%87%aa%e5%b8%a6%e7%b1%bb%e5%9e%8b">5. 自带类型</a><ul>
<li><a href="#51-%e6%95%b0%e5%80%bc">5.1 数值</a></li>
<li><a href="#52-%e5%ad%97%e7%ac%a6%e4%b8%b2">5.2 字符串</a></li>
<li><a href="#53-%e5%b8%83%e5%b0%94">5.3 布尔</a></li>
<li><a href="#54-%e6%95%b0%e7%bb%84">5.4 数组</a></li>
<li><a href="#55-%e9%9b%86">5.5 集</a></li>
<li><a href="#56-%e8%a1%a8">5.6 表</a></li>
<li><a href="#57-runes">5.7 Runes</a></li>
<li><a href="#58-%e7%ac%a6%e5%8f%b7">5.8 符号</a></li>
</ul>
</li>
<li><a href="#6-%e5%87%bd%e6%95%b0">6. 函数</a><ul>
<li><a href="#61-%e5%8f%af%e9%80%89%e5%8f%82%e6%95%b0">6.1 可选参数</a></li>
<li><a href="#62-main-%e5%87%bd%e6%95%b0">6.2 main() 函数</a></li>
<li><a href="#63-%e4%b8%80%e7%ad%89%e5%85%ac%e6%b0%91%e5%87%bd%e6%95%b0">6.3 一等公民函数</a></li>
<li><a href="#64-%e5%8c%bf%e5%90%8d%e5%87%bd%e6%95%b0">6.4 匿名函数</a></li>
<li><a href="#65-%e4%bd%9c%e7%94%a8%e5%9f%9f">6.5 作用域</a></li>
<li><a href="#66-%e8%af%8d%e6%b3%95%e9%97%ad%e5%8c%85">6.6 词法闭包</a></li>
<li><a href="#67-%e5%87%bd%e6%95%b0%e7%9a%84%e7%ad%89%e4%bb%b7%e6%80%a7">6.7 函数的等价性</a></li>
<li><a href="#68-%e8%bf%94%e5%9b%9e%e5%80%bc">6.8 返回值</a></li>
</ul>
</li>
<li><a href="#7-%e8%bf%90%e7%ae%97%e7%ac%a6">7. 运算符</a><ul>
<li><a href="#71-%e7%ae%97%e6%95%b0%e8%bf%90%e7%ae%97%e7%ac%a6">7.1 算数运算符</a></li>
<li><a href="#72-%e5%85%b3%e7%b3%bb%e8%bf%90%e7%ae%97%e6%b3%95">7.2 关系运算法</a></li>
<li><a href="#73-%e7%b1%bb%e5%9e%8b%e6%8e%a8%e6%96%ad%e8%bf%90%e7%ae%97%e7%ac%a6">7.3 类型推断运算符</a></li>
<li><a href="#74-%e8%b5%8b%e5%80%bc%e8%bf%90%e7%ae%97%e7%ac%a6">7.4 赋值运算符</a></li>
<li><a href="#75-%e9%80%bb%e8%be%91%e8%bf%90%e7%ae%97%e7%ac%a6">7.5 逻辑运算符</a></li>
<li><a href="#76-%e4%bd%8d%e7%a7%bb%e8%bf%90%e7%ae%97%e7%ac%a6">7.6 位移运算符</a></li>
<li><a href="#77-%e6%9d%a1%e4%bb%b6%e8%a1%a8%e8%be%be%e5%bc%8f">7.7 条件表达式</a></li>
<li><a href="#78-%e5%a4%9a%e7%ba%a7%e8%a1%a8%e7%a4%ba%e6%b3%95">7.8 多级表示法</a></li>
<li><a href="#79-%e5%85%b6%e5%ae%83">7.9 其它</a></li>
</ul>
</li>
<li><a href="#8-%e6%8e%a7%e5%88%b6%e8%af%ad%e5%8f%a5">8. 控制语句</a><ul>
<li><a href="#81-if-else">8.1 If else</a></li>
<li><a href="#82-for-%e5%be%aa%e7%8e%af">8.2 For 循环</a></li>
<li><a href="#83-while--do-while">8.3 While &amp; do-while</a></li>
<li><a href="#84-break--continue">8.4 Break &amp; continue</a></li>
<li><a href="#85-switch-case">8.5 Switch case</a></li>
<li><a href="#86-%e6%96%ad%e8%a8%80">8.6 断言</a></li>
</ul>
</li>
<li><a href="#9-%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86">9. 异常处理</a><ul>
<li><a href="#91-throw">9.1 Throw</a></li>
<li><a href="#92-catch">9.2 Catch</a></li>
<li><a href="#93-finally">9.3 Finally</a></li>
</ul>
</li>
<li><a href="#10-%e7%b1%bb">10. 类</a><ul>
<li><a href="#101-%e4%bd%bf%e7%94%a8%e7%b1%bb%e6%88%90%e5%91%98%e5%8f%98%e9%87%8f">10.1 使用类成员变量</a></li>
<li><a href="#102-%e4%bd%bf%e7%94%a8%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0">10.2 使用构造函数</a></li>
<li><a href="#103-%e8%8e%b7%e5%8f%96%e5%af%b9%e8%b1%a1%e7%b1%bb%e5%9e%8b">10.3 获取对象类型</a></li>
<li><a href="#104-%e5%ae%9e%e4%be%8b%e5%8f%98%e9%87%8f">10.4 实例变量</a></li>
<li><a href="#105-%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0">10.5 构造函数</a></li>
<li><a href="#106-%e6%96%b9%e6%b3%95">10.6 方法</a></li>
<li><a href="#107-%e6%8a%bd%e8%b1%a1%e7%b1%bb">10.7 抽象类</a></li>
<li><a href="#108-%e9%9a%90%e5%bc%8f%e6%8e%a5%e5%8f%a3">10.8 隐式接口</a></li>
<li><a href="#109-%e6%89%a9%e5%b1%95%e7%b1%bb">10.9 扩展类</a></li>
<li><a href="#1010-%e6%9e%9a%e4%b8%be%e7%b1%bb%e5%9e%8b">10.10 枚举类型</a></li>
<li><a href="#1011-%e7%b1%bb%e6%b7%bb%e5%8a%a0%e7%89%b9%e6%80%a7">10.11 类添加特性</a></li>
<li><a href="#1012-%e7%b1%bb%e5%8f%98%e9%87%8f%e5%92%8c%e6%96%b9%e6%b3%95">10.12 类变量和方法</a></li>
</ul>
</li>
<li><a href="#11-%e6%b3%9b%e5%9e%8b">11. 泛型</a><ul>
<li><a href="#111-%e4%b8%ba%e4%bb%80%e4%b9%88%e4%bd%bf%e7%94%a8%e6%b3%9b%e5%9e%8b">11.1 为什么使用泛型</a></li>
<li><a href="#112-%e4%bd%bf%e7%94%a8%e9%9b%86%e5%90%88%e5%ad%97%e9%9d%a2%e5%80%bc">11.2 使用集合字面值</a></li>
<li><a href="#113-%e4%bd%bf%e7%94%a8%e5%b8%a6%e5%8f%82%e6%95%b0%e5%8c%96%e7%b1%bb%e5%9e%8b%e7%9a%84%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0">11.3 使用带参数化类型的构造函数</a></li>
<li><a href="#114-%e6%b3%9b%e5%9e%8b%e9%9b%86%e5%90%88">11.4 泛型集合</a></li>
<li><a href="#115-%e6%b3%9b%e5%9e%8b%e7%ba%a6%e6%9d%9f">11.5 泛型约束</a></li>
<li><a href="#116-%e4%bd%bf%e7%94%a8%e6%b3%9b%e5%9e%8b%e6%96%b9%e6%b3%95">11.6 使用泛型方法</a></li>
</ul>
</li>
<li><a href="#12-%e5%ba%93">12. 库</a><ul>
<li><a href="#121-%e4%bd%bf%e7%94%a8%e5%ba%93">12.1 使用库</a></li>
<li><a href="#122-%e5%ae%9e%e7%8e%b0%e5%ba%93">12.2 实现库</a></li>
</ul>
</li>
<li><a href="#13-%e5%bc%82%e6%ad%a5">13. 异步</a><ul>
<li><a href="#131-%e5%a4%84%e7%90%86-future">13.1 处理 Future</a></li>
<li><a href="#132-%e5%a3%b0%e6%98%8e%e5%bc%82%e6%ad%a5%e5%87%bd%e6%95%b0">13.2 声明异步函数</a></li>
<li><a href="#133-%e5%a4%84%e7%90%86%e6%b5%81">13.3 处理流</a></li>
</ul>
</li>
<li><a href="#14-%e7%94%9f%e6%88%90%e5%99%a8">14. 生成器</a></li>
<li><a href="#15-%e5%8f%af%e8%b0%83%e7%94%a8%e7%9a%84%e7%b1%bb">15. 可调用的类</a></li>
<li><a href="#16-%e7%8b%ac%e7%ab%8b%e6%80%a7">16. 独立性</a></li>
<li><a href="#17-%e7%b1%bb%e5%9e%8b%e5%ae%9a%e4%b9%89">17. 类型定义</a></li>
<li><a href="#18-%e5%85%83%e6%95%b0%e6%8d%ae">18. 元数据</a></li>
<li><a href="#19-%e6%b3%a8%e9%87%8a">19. 注释</a></li>
<li><a href="#20-%e5%b0%8f%e7%bb%93">20. 小结</a></li>
</ul>
<h2 id="1-一段基础的-Dart-程序"><a href="#1-一段基础的-Dart-程序" class="headerlink" title="1. 一段基础的 Dart 程序"></a>1. 一段基础的 Dart 程序</h2><p>从以下代码片段感受下 Dart 语言的特性：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Define a function.</span></span><br><span class="line">printIteger(<span class="built_in">int</span> number) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'The number is $number'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is where the app starts executing.</span></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">var</span> number = <span class="number">42</span>; <span class="comment">// Declare and initialize a variable.</span></span><br><span class="line">    printInteger(number); <span class="comment">// Call a function.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段程序使用的特性适用于其他所有 Dart 应用：</p>
<p>// This is a comment.<br><br>一个单行注释。另外，Dart 也支持多行和文档注视。更多信息看<a href="https://dart.dev/guides/language/language-tour#comments" target="_blank" rel="noopener">注释文档</a>。</p>
<p>int<br><br>Dart 自带类型之一，其他的还有 <em>String</em>, <em>List</em> 和 <em>bool</em>。</p>
<p>42<br><br>数值字面值，编译时期常量。</p>
<p>print()<br><br>打印输出。</p>
<p>‘…’ 或者 “…”<br><br>字符串字面值。</p>
<p>$variableNmae 或者 ${variableName}<br><br>字符串差值写法。更多请查看<a href="https://dart.dev/guides/language/language-tour#strings" target="_blank" rel="noopener">文档</a>。</p>
<p>main()<br><br>App 执行入口，每个应用必须有。更多信息查看<a href="https://dart.dev/guides/language/language-tour#the-main-function" target="_blank" rel="noopener">文档</a>。</p>
<h2 id="2-重要概念"><a href="#2-重要概念" class="headerlink" title="2. 重要概念"></a>2. 重要概念</h2><p>学习 Dart 过程中，牢记以下概念：<br></p>
<ul>
<li>任何可以存到变量中的都是对象，每个对象都是类的实例。数值、函数和 <code>null</code> 都是对象。所有对象都继承自 <a href="https://api.dart.dev/stable/dart-core/Object-class.html" target="_blank" rel="noopener">Object</a> 类。</li>
<li>虽然 Dart 是强类型的，但类型声明是可选的，因为 Dart 有类型推断。上述代码中， <code>number</code> 并没有声明类型，被自动推断成 <code>int</code>j。可以使用<a href="https://dart.dev/guides/language/effective-dart/design#do-annotate-with-object-instead-of-dynamic-to-indicate-any-object-is-allowed" target="_blank" rel="noopener">特定的动态类型</a>，来声明任意类型的变量。</li>
<li>Dart 支持泛型，比如 <code>List&lt;int&gt;</code> 和 <code>List&lt;dynamic&gt;</code>。</li>
<li>Dart 支持将函数声明在类内部（<em>实例方法</em>）和外部（<em>静态方法</em>），也支持<em>嵌套函数</em>。</li>
<li>类似的，Dart 也支持将变量声明在类内部（<em>实例变量<em>）和外部（</em>静态变量<em>）。实例变量也叫做域(</em>field</em>)或属性(<em>property</em>)。</li>
<li>不同于 Java，Dart 没有 <code>public</code>, <code>protected</code> 和 <code>private</code> 关键字。可以使用 <code>_</code> 开头的标识符来表示变量是库内私有的。更多信息请看<a href="https://dart.dev/guides/language/language-tour#libraries-and-visibility" target="_blank" rel="noopener">文档</a>。</li>
<li>标识符以字母和下划线开头，后面可以跟字母数字下划线。</li>
<li>Dart 有表达式(<em>expressions</em>)和语句(<em>statements</em>)。</li>
<li>Dart 工具有两种报错类型：<em>警告</em>和<em>错误</em>。警告表示代码运行结果可能不同于期望，但不会使程序退出。错误分为编译期和运行时。编译器错误会导致程序无法启动，运行时错误会导致程序运行时抛出异常。</li>
</ul>
<h2 id="3-关键字"><a href="#3-关键字" class="headerlink" title="3. 关键字"></a>3. 关键字</h2><table>
<thead>
<tr>
<th align="left"></th>
<th align="center"></th>
<th align="center"></th>
<th align="right"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">abstract<sup>2</sup></td>
<td align="center">dynamic<sup>2</sup></td>
<td align="center">implements<sup>2</sup></td>
<td align="right">show<sup>1</sup></td>
</tr>
<tr>
<td align="left">as<sup>2</sup></td>
<td align="center">else</td>
<td align="center">import<sup>2</sup></td>
<td align="right">static<sup>2</sup></td>
</tr>
<tr>
<td align="left">assert</td>
<td align="center">enum</td>
<td align="center">in</td>
<td align="right">super</td>
</tr>
<tr>
<td align="left">async<sup>1</sup></td>
<td align="center">export<sup>2</sup></td>
<td align="center">interface<sup>2</sup></td>
<td align="right">switch</td>
</tr>
<tr>
<td align="left">await<sup>3</sup></td>
<td align="center">extends</td>
<td align="center">is</td>
<td align="right">sync<sup>1</sup></td>
</tr>
<tr>
<td align="left">break</td>
<td align="center">external<sup>2</sup></td>
<td align="center">library<sup>2</sup></td>
<td align="right">this</td>
</tr>
<tr>
<td align="left">case</td>
<td align="center">factory<sup>2</sup></td>
<td align="center">mixin<sup>2</sup></td>
<td align="right">throw</td>
</tr>
<tr>
<td align="left">catch</td>
<td align="center">false</td>
<td align="center">new</td>
<td align="right">true</td>
</tr>
<tr>
<td align="left">class</td>
<td align="center">final</td>
<td align="center">null</td>
<td align="right">try</td>
</tr>
<tr>
<td align="left">const</td>
<td align="center">finally</td>
<td align="center">on<sup>1</sup></td>
<td align="right">typedef<sup>2</sup></td>
</tr>
<tr>
<td align="left">continue</td>
<td align="center">for</td>
<td align="center">operator<sup>2</sup></td>
<td align="right">var</td>
</tr>
<tr>
<td align="left">convariant<sup>2</sup></td>
<td align="center">Function<sup>2</sup></td>
<td align="center">part<sup>2</sup></td>
<td align="right">void</td>
</tr>
<tr>
<td align="left">default</td>
<td align="center">get<sup>2</sup></td>
<td align="center">rethrow</td>
<td align="right">while</td>
</tr>
<tr>
<td align="left">deferred<sup>2</sup></td>
<td align="center">hide<sup>1</sup></td>
<td align="center">return</td>
<td align="right">with</td>
</tr>
<tr>
<td align="left">do</td>
<td align="center">if</td>
<td align="center">set<sup>2</sup></td>
<td align="right">yield<sup>3</sup></td>
</tr>
</tbody></table>
<p>尽量避免使用以上关键字作为标识符。如果不可避免需要使用，可以用上角标标记：</p>
<ul>
<li>角标 1 单词是上下文相关的，只有在特定位置才有意义。他们可以在任意位置使用。</li>
<li>角标 2 单词是自带标识符。为简化 JS 代码移植到 Dart 的难度，这些关键字不能用作类或者类型的名字以及导入的前缀。</li>
<li>角标 3 单词是少有的几个跟异步操作相关的关键字，Dart 1.0 发布后才加入。不能在任何标记 <code>async</code>, <code>async*</code> 以及 <code>sync*</code> 的函数体中使用 <code>await</code> 和 <code>yield</code> 作为标识符。</li>
</ul>
<p>剩余的关键字是保留使用的，不能作为标识符。</p>
<h2 id="4-变量"><a href="#4-变量" class="headerlink" title="4. 变量"></a>4. 变量</h2><p>创建并初始化一个变量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'Bob'</span>;</span><br></pre></td></tr></table></figure>

<p>变量保存引用，<code>name</code> 变量保存对一个 <code>String</code> 对象的引用。</p>
<p><code>name</code> 变量推断成 <code>String</code> 类型，也可以通过显示声明类型修改。如果对象不是限制为单一类型，可以使用 <code>Object</code> 或 <code>dynamic</code> 修饰。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dynamic</span> name = <span class="string">'Bob'</span>;</span><br></pre></td></tr></table></figure>

<p>另一种方式是显示声明类型：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> name = <span class="string">'Bob'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-默认值"><a href="#4-1-默认值" class="headerlink" title="4.1 默认值"></a>4.1 默认值</h3><p>未主动初始化的变量默认初始化为 <code>null</code>。即使是数值类型也是如此，在 Dart 的世界里，万物皆对象。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> lineCount;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;lineCount == <span class="keyword">null</span>&#125;</span>'</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-Final-和-const-关键字"><a href="#4-2-Final-和-const-关键字" class="headerlink" title="4.2 Final 和 const 关键字"></a>4.2 Final 和 const 关键字</h3><p>对于初始化后就不再修改的变量，使用 <code>final</code> 或 <code>const</code> 替代 <code>var</code> 或者类型。final 变量只能设置一次，const 变量是一个编译期常量。一个顶层(top-level)的类变量在第一次使用的时候初始化。</p>
<p>创建并设置一个 final 变量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> name = <span class="string">'Bab'</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="built_in">String</span> nickname = <span class="string">'Bobby'</span>;</span><br></pre></td></tr></table></figure>

<p>不能修改 final 变量的值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">'Alice'</span>;</span><br></pre></td></tr></table></figure>

<p>使用 <code>const</code> 创建<strong>编译期常量</strong>。如果是静态常量，使用 <code>static const</code> 修饰。常量必须在声明的时候用字面值或者算术表达式初始化:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bar = <span class="number">1000000</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">double</span> atm = <span class="number">1.01325</span> * bar;</span><br></pre></td></tr></table></figure>

<p><code>const</code> 关键字不仅限于声明常量，还可以用于创建常量的值，以及声明构造函数用于创建常量值。任意变量都可以有一个常量值。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="keyword">const</span> [];</span><br><span class="line"><span class="keyword">final</span> bar = <span class="keyword">const</span> [];</span><br><span class="line"><span class="keyword">const</span> baz = [];</span><br></pre></td></tr></table></figure>

<p>当用 <code>const</code> 声明一个常量，可以省略初始化表达式中的 <code>const</code>。</p>
<p>对于非 const 或 非 final 声明的变量，即使之前存的值是一个常量，仍然可以修改：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="comment">// 之前是 []</span></span><br></pre></td></tr></table></figure>

<p>但是不能修改一个 const 变量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">baz = [<span class="number">42</span>]; <span class="comment">// Error</span></span><br></pre></td></tr></table></figure>

<h2 id="5-自带类型"><a href="#5-自带类型" class="headerlink" title="5. 自带类型"></a>5. 自带类型</h2><p>Dart 对以下类型做了特殊支持：</p>
<ul>
<li>numbers</li>
<li>strings</li>
<li>booleans</li>
<li>lists</li>
<li>sets</li>
<li>maps</li>
<li>runes(用于在字符串中表达 Unicode 字符)</li>
<li>symbols</li>
</ul>
<p>可以用以上任意类型的字面值初始化对象。比如，<code>this is a string</code> 是一个字符串字面值，<code>true</code> 是一个布尔字面值。</p>
<p>因为 Dart 中的变量都保存一个对象的引用，所以可用构造器（<em>constructors</em>)初始化变量。部分自带类型有自己的构造器。比如，用 <code>Map()</code> 创建一个表。</p>
<h3 id="5-1-数值"><a href="#5-1-数值" class="headerlink" title="5.1 数值"></a>5.1 数值</h3><p>Dart 支持两种数值：</p>
<p>int<br><br>整型值。</p>
<p>double<br><br>64位浮点数。</p>
<p><code>int</code>, <code>float</code> 都是 num 子类（subtypes)。num 定义了 +, -, * 和 /，以及 <code>abs()</code>, <code>ceil()</code> 和 <code>floor()</code> 等方法（位运算符定义在 <code>int</code>）。其他方法可能定义在 <code>dart:math</code> 库中。</p>
<p>整型值是不带小数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> hex = <span class="number">0xDEADBEEF</span>;</span><br></pre></td></tr></table></figure>

<p>如果数值包含小数，那它就是 double。浮点数字面值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> y = <span class="number">1.1</span></span><br><span class="line"><span class="keyword">var</span> exponents = <span class="number">1.42e5</span>;</span><br></pre></td></tr></table></figure>

<p>字符串和数值相互转换：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// String -&gt; int</span></span><br><span class="line"><span class="keyword">var</span> one = <span class="built_in">int</span>.parse(<span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">assert</span>(one == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// String -&gt; double</span></span><br><span class="line"><span class="keyword">var</span> onePointOne = <span class="built_in">double</span>.parse(<span class="string">'1.1'</span>);</span><br><span class="line"><span class="keyword">assert</span>(onePointOne == <span class="number">1.1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// int -&gt; String</span></span><br><span class="line"><span class="built_in">String</span> oneAsString= <span class="number">1.</span>toString();</span><br><span class="line"><span class="keyword">assert</span>(oneAsString == <span class="string">'1'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// double -&gt; String</span></span><br><span class="line"><span class="built_in">String</span> piAsString = <span class="number">3.14159</span>.toStringAsFixed(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">assert</span>(piAsString == <span class="string">'3.14'</span>);</span><br></pre></td></tr></table></figure>

<p>整型的位操作：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>((<span class="number">3</span> &gt;&gt; <span class="number">1</span>) == <span class="number">1</span>);</span><br><span class="line"><span class="keyword">assert</span>((<span class="number">3</span> &lt;&lt; <span class="number">1</span>) == <span class="number">6</span>);</span><br><span class="line"><span class="keyword">assert</span>((<span class="number">3</span> | <span class="number">4</span>) == <span class="number">7</span>);</span><br></pre></td></tr></table></figure>

<p>数值字面值是编译期常量。算术表达式包含的操作数都是编译期常量，那么该表达式也是编译期常量。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> msPerSecond = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">const</span> secondsUntilRetry = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> msUntilRetry = secondsUntilRetry * msPerSecond;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-字符串"><a href="#5-2-字符串" class="headerlink" title="5.2 字符串"></a>5.2 字符串</h3><p>Dart 字符串是 UTF-16 单元码的序列。可以用单引号或双引号创建字符串。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">'Single quotes work well for string literals'</span>;</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="string">"Double quotes work just as well"</span>;</span><br><span class="line"><span class="keyword">var</span> s3 = <span class="string">'It\'s easy to escape the string delimeter'</span>;</span><br><span class="line"><span class="keyword">var</span> s4 = <span class="string">"It's even easier to use the other delimeter"</span>;</span><br></pre></td></tr></table></figure>

<p>字符串包含表达式的方式，用 <code>${expression}</code>。如果表达式是个标识符，可以省略 {}。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">'string interpolation'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'Dart has $s, which is very handy.'</span> ==</span><br><span class="line">    <span class="string">'Dart has string interpolation, '</span> +</span><br><span class="line">        <span class="string">'which is very handy.'</span>);</span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'That deserves all caps. '</span> +</span><br><span class="line">        <span class="string">'<span class="subst">$&#123;s.toUpperCase()&#125;</span> is very handy!'</span> ==</span><br><span class="line">    <span class="string">'That deserves all caps. '</span> +</span><br><span class="line">        <span class="string">'STRING INTERPOLATION is very handy!'</span>);</span><br></pre></td></tr></table></figure>

<p>拼接字符串可以用 <code>+</code> 运算符：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">'String '</span></span><br><span class="line">    <span class="string">'concatenation'</span></span><br><span class="line">    <span class="string">" works even over line breaks."</span>;</span><br><span class="line"><span class="keyword">assert</span>(s1 ==</span><br><span class="line">    <span class="string">'String concatenation works even over '</span></span><br><span class="line">        <span class="string">'line breaks.'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s2 = <span class="string">'The + operator '</span> + <span class="string">'works, as well.'</span>;</span><br><span class="line"><span class="keyword">assert</span>(s2 == <span class="string">'The + operator works, as well.'</span>);</span><br></pre></td></tr></table></figure>

<p>创建多行字符串的方式：使用 <code>&#39;&#39;&#39;</code> 或 <code>&quot;&quot;&quot;</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">'''</span></span><br><span class="line"><span class="string">You can create</span></span><br><span class="line"><span class="string">multi-line strings like this one.</span></span><br><span class="line"><span class="string">'''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s2 = <span class="string">"""This is also a</span></span><br><span class="line"><span class="string">multi-line string."""</span>;</span><br></pre></td></tr></table></figure>

<p>创建原始的字符串方式：使用 <code>r</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">r'In a raw string, not even \n gets special treatment.'</span>;</span><br></pre></td></tr></table></figure>

<p>字符串字面值是编译期常量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// These work in a const string.</span></span><br><span class="line"><span class="keyword">const</span> aConstNum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> aConstBool = <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">const</span> aConstString = <span class="string">'a constant string'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// These do NOT work in a const string.</span></span><br><span class="line"><span class="keyword">var</span> aNum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> aBool = <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">var</span> aString = <span class="string">'a string'</span>;</span><br><span class="line"><span class="keyword">const</span> aConstList = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> validConstString = <span class="string">'$aConstNum $aConstBool $aConstString'</span>;</span><br><span class="line"><span class="comment">// const invalidConstString = '$aNum $aBool $aString $aConstList';</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-布尔"><a href="#5-3-布尔" class="headerlink" title="5.3 布尔"></a>5.3 布尔</h3><p>Dart 用 <code>bool</code> 表示布尔值。只有两个对象有布尔类型：布尔字面值 <code>true</code> 和 <code>false</code>，两者都是编译期常量。</p>
<p>Dart 是类型安全的，意味着 <code>if (nonbooleanValue)</code> 或者 <code>assert (nonbooleanValue)</code> 是不合法的。应该用显式的值校验：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check for an empty string.</span></span><br><span class="line"><span class="keyword">var</span> fullName = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">assert</span>(fullName.isEmpty);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check for zero.</span></span><br><span class="line"><span class="keyword">var</span> hitPoints = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">assert</span>(hitPoints &lt;= <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check for null.</span></span><br><span class="line"><span class="keyword">var</span> unicorn;</span><br><span class="line"><span class="keyword">assert</span>(unicorn == <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check for NaN.</span></span><br><span class="line"><span class="keyword">var</span> iMeantToDoThis = <span class="number">0</span> / <span class="number">0</span>;</span><br><span class="line"><span class="keyword">assert</span>(iMeantToDoThis.isNaN);</span><br></pre></td></tr></table></figure>

<h3 id="5-4-数组"><a href="#5-4-数组" class="headerlink" title="5.4 数组"></a>5.4 数组</h3><p>几乎在所有编程语言中，最通用的集合(collection)是<em>数组*或者说是对象组。Dart 中，数组是 *List</em> 对象。</p>
<p>Dart 数组字面值类似 JS。例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>

<p>数组索引范围[0, list.length-1]：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">assert</span>(list.length == <span class="number">3</span>);</span><br><span class="line"><span class="keyword">assert</span>(list[<span class="number">1</span>] == <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">list[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">assert</span>(list[<span class="number">1</span>] == <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>创建编译期常量的数组方法，在数组字面值前加 <code>const</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> constantList = <span class="keyword">const</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">constantList[<span class="number">1</span>] = <span class="number">1</span>; <span class="comment">// Uncommenting this causes an error.</span></span><br></pre></td></tr></table></figure>

<p>Dart 2.3 中引入了 <strong>展开操作符(spread operator(…))</strong> 和 <strong>可空的(null-aware)展开操作符(…?)</strong>，两者都提供了将多个元素插入集合的便捷方法。</p>
<p>如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> list2 = [<span class="number">0</span>, ...list];</span><br><span class="line"><span class="keyword">assert</span>(list2.length == <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>如果展开操作符右边表达式可能为空，可用 <code>...?</code> 来避免异常：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list:</span><br><span class="line"><span class="keyword">var</span> list2 = [<span class="number">0</span>, ...?list];</span><br><span class="line"><span class="keyword">assert</span>(list2.length == <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>另外，Dart 2.3 还引入了 <strong>collection if</strong> 和 <strong>collection for</strong>，用来构造集合。</p>
<p><strong>Collection if</strong> 例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nav = [</span><br><span class="line">    <span class="string">'Home'</span>,</span><br><span class="line">    <span class="string">'Furniture'</span>,</span><br><span class="line">    <span class="string">'Plants'</span>,</span><br><span class="line">    <span class="keyword">if</span> (promoActive) <span class="string">'Outlet'</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><strong>Collection for</strong> 例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> list2 = [</span><br><span class="line">    <span class="string">'#0'</span>,</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> list1) <span class="string">'#$i'</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">assert</span>(list2[<span class="number">1</span>] == <span class="string">'#1'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="5-5-集"><a href="#5-5-集" class="headerlink" title="5.5 集"></a>5.5 集</h3><p>Dart 集无序且元素唯一。Dart 通过两方面支持集，一个是字面值，另一个是 <code>Set</code> 类型。</p>
<p>字面值创建集对象：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> halogens = &#123;<span class="string">'fluorine'</span>, <span class="string">'chlorine'</span>, <span class="string">'bromine'</span>, <span class="string">'iodine'</span>, <span class="string">'astatine'</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>创建空集：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> set1 = &lt;<span class="built_in">String</span>&gt;&#123;&#125;;</span><br><span class="line"><span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt; set2 = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> map = &#123;&#125;; <span class="comment">// Create a map, not a set.</span></span><br></pre></td></tr></table></figure>

<p>集添加元素，<code>add()</code> 或者 <code>addAll()</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> set1 = &lt;<span class="built_in">String</span>&gt;&#123;&#125;;</span><br><span class="line">set1.add(<span class="string">'fluorine'</span>);</span><br><span class="line">set1.addAll(halogens);</span><br></pre></td></tr></table></figure>

<p>使用 <code>.length</code> 获取集的大小：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> set1 = &lt;<span class="built_in">String</span>&gt;&#123;&#125;;</span><br><span class="line">set1.add(<span class="string">'fluorine'</span>);</span><br><span class="line">set1.addAll(halogens);</span><br><span class="line"><span class="keyword">assert</span>(set1.length == <span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<p>创建集的编译期字面值，集字面值前加 <code>const</code> 关键字：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> constantSet = <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="string">'fluorine'</span>,</span><br><span class="line">  <span class="string">'chlorine'</span>,</span><br><span class="line">  <span class="string">'bromine'</span>,</span><br><span class="line">  <span class="string">'iodine'</span>,</span><br><span class="line">  <span class="string">'astatine'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// constantSet.add('helium'); // Uncommenting this causes an error.</span></span><br></pre></td></tr></table></figure>

<p>Dart 2.3 后，集也同数组一样，支持展开操作符和 collection fors 以及 ifs。</p>
<h3 id="5-6-表"><a href="#5-6-表" class="headerlink" title="5.6 表"></a>5.6 表</h3><p>表包含键值对，键值可以是任意类型的对象。Key 在表中唯一，value 可以重复。Dart 通过两方面支持表，一个是字面值，另一个是 Map 类型。</p>
<p>Dart 表的字面值例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gifts = &#123;</span><br><span class="line">  <span class="comment">// Key:    Value</span></span><br><span class="line">  <span class="string">'first'</span>: <span class="string">'partridge'</span>,</span><br><span class="line">  <span class="string">'second'</span>: <span class="string">'turtledoves'</span>,</span><br><span class="line">  <span class="string">'fifth'</span>: <span class="string">'golden rings'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nobleGases = &#123;</span><br><span class="line">  <span class="number">2</span>: <span class="string">'helium'</span>,</span><br><span class="line">  <span class="number">10</span>: <span class="string">'neon'</span>,</span><br><span class="line">  <span class="number">18</span>: <span class="string">'argon'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>也可以用构造函数创建的表对象：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gifts = <span class="built_in">Map</span>();</span><br><span class="line">gifts[<span class="string">'first'</span>] = <span class="string">'partridge'</span>;</span><br><span class="line">gifts[<span class="string">'second'</span>] = <span class="string">'turtledoves'</span>;</span><br><span class="line">gifts[<span class="string">'fifth'</span>] = <span class="string">'golden rings'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nobleGases = <span class="built_in">Map</span>();</span><br><span class="line">nobleGases[<span class="number">2</span>] = <span class="string">'helium'</span>;</span><br><span class="line">nobleGases[<span class="number">10</span>] = <span class="string">'neon'</span>;</span><br><span class="line">nobleGases[<span class="number">18</span>] = <span class="string">'argon'</span>;</span><br></pre></td></tr></table></figure>

<p>对已有表中增加键值对：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gifts = &#123;<span class="string">'first'</span>: <span class="string">'partridge'</span>&#125;;</span><br><span class="line">gifts[<span class="string">'fourth'</span>] = <span class="string">'calling birds'</span>; <span class="comment">// Add a key-value pair</span></span><br></pre></td></tr></table></figure>

<p>从表中获取值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gifts = &#123;<span class="string">'first'</span>: <span class="string">'partridge'</span>&#125;;</span><br><span class="line"><span class="keyword">assert</span>(gifts[<span class="string">'first'</span>] == <span class="string">'partridge'</span>);</span><br></pre></td></tr></table></figure>

<p>从表中查不到对应的 key：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gifts = &#123;<span class="string">'first'</span>: <span class="string">'partridge'</span>&#125;;</span><br><span class="line"><span class="keyword">assert</span>(gifts[<span class="string">'fifth'</span>] == <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<p>用 <code>.length</code> 获取表中键值对数量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gifts = &#123;<span class="string">'first'</span>: <span class="string">'partridge'</span>&#125;;</span><br><span class="line">gifts[<span class="string">'fourth'</span>] = <span class="string">'calling birds'</span>;</span><br><span class="line"><span class="keyword">assert</span>(gifts.length == <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>创建表的编译期常量，表字面值前加 <code>const</code> 关键字：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> constantMap = <span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="number">2</span>: <span class="string">'helium'</span>,</span><br><span class="line">  <span class="number">10</span>: <span class="string">'neon'</span>,</span><br><span class="line">  <span class="number">18</span>: <span class="string">'argon'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Dart 2.3 后，表也同数组一样，支持展开操作符和 collection fors 以及 ifs。</p>
<h3 id="5-7-Runes"><a href="#5-7-Runes" class="headerlink" title="5.7 Runes"></a>5.7 Runes</h3><p>Dart runes 是字符串的 UTF-32 码点。</p>
<p>Unicode 为全世界所有字母，数字和符号定义了唯一的数值。由于 Dart 字符串是 UTF-16 单元码的序列，因此在字符串中药表示 32位 Unicode 值需要特殊语法。</p>
<p>通常表达一个 Unicode 码点的形式是 <code>\uXXXX</code>，XXXX 是一个4位的16进制数。比如，爱心字符(♥)是 <code>\u2665</code>。当指定多于或少于4位数字时，将值放在花括号中。</p>
<p>String 类有一些相关属性获取 rune 信息。比如，<code>codeUnitAt</code> 和 <code>codeUnit</code> 属性返回16位的单元码，用 <code>runes</code> 属性获取字符串中的 runes。</p>
<p>16位和32位转换：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main() &#123;</span><br><span class="line">  <span class="keyword">var</span> clapping = <span class="string">'\u&#123;1f44f&#125;'</span>;</span><br><span class="line">  <span class="built_in">print</span>(clapping);</span><br><span class="line">  <span class="built_in">print</span>(clapping.codeUnits);</span><br><span class="line">  <span class="built_in">print</span>(clapping.runes.toList());</span><br><span class="line"></span><br><span class="line">  Runes input = <span class="keyword">new</span> Runes(</span><br><span class="line">      <span class="string">'\u2665  \u&#123;1f605&#125;  \u&#123;1f60e&#125;  \u&#123;1f47b&#125;  \u&#123;1f596&#125;  \u&#123;1f44d&#125;'</span>);</span><br><span class="line">  <span class="built_in">print</span>(<span class="keyword">new</span> <span class="built_in">String</span>.fromCharCodes(input));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-8-符号"><a href="#5-8-符号" class="headerlink" title="5.8 符号"></a>5.8 符号</h3><p><em>符号</em> 对象代表 Dart 程序中的运算符或者标识符。你可能从不会用符号，但它们对于按名称引用标识符的 API 非常有用，因为缩小会更改标识符名称而不会更改标识符符号。</p>
<p>获取符号的方法，<code>#</code> 号后面跟着标识符：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#radix</span><br><span class="line">#bar</span><br></pre></td></tr></table></figure>

<p>符号字面值是编译期常量。</p>
<h2 id="6-函数"><a href="#6-函数" class="headerlink" title="6. 函数"></a>6. 函数</h2><p>Dart 是真正的面向对象语言，即使是函数也有类型，<em>Funtion</em>。这意味着函数可以赋值给变量或者作为参数传递。还可以调用类的实例，就好像它是一个函数。更多信息查看<a href="https://dart.dev/guides/language/language-tour#callable-classes" target="_blank" rel="noopener">文档</a>。</p>
<p>函数的实现如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> isNoble(<span class="built_in">int</span> atomicNumber) &#123;</span><br><span class="line">    <span class="keyword">return</span> _nobleGases[atomicNumber] != <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然类型标注更为高效，但是省略类型的函数依然可用：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isNoble(atomicNumber) &#123;</span><br><span class="line">  <span class="keyword">return</span> _nobleGases[atomicNumber] != <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于只有一个表达式的函数，可以简写为：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> isNoble(<span class="built_in">int</span> atomicNumber) =&gt; _nobleGases[atomicNumber] != <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p><code>=&gt; expr</code> 语法是 <code>{ return expr; } 的简写。</code>=&gt;` 标注通常推断为<em>箭头</em>语法。</p>
<p>函数参数支持两种类型：必需(required)和可选(optional)。必需参数在前，可选参数在后。命名为可选的参数仍然可以标记为 <code>@required</code>。</p>
<h3 id="6-1-可选参数"><a href="#6-1-可选参数" class="headerlink" title="6.1 可选参数"></a>6.1 可选参数</h3><p>通过位置或命名中的一种来标记可选参数，但不能两者同时使用。</p>
<h4 id="可选命名参数"><a href="#可选命名参数" class="headerlink" title="可选命名参数 "></a>可选命名参数 <!-- omit in toc --></h4><p>调用一个函数，可通过 <code>paramName: value</code> 指定命名的参数，比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enableFlags(bold: <span class="keyword">true</span>, hidde: <span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>

<p>在定义函数的时候，使用 <code>{param1, param2, ...}</code> 指定命名参数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Sets the [bold] and [hidden] flags ...</span></span><br><span class="line"><span class="keyword">void</span> enableFlags(&#123;<span class="built_in">bool</span> bold, <span class="built_in">bool</span> hidden&#125;) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p><em>Flutter</em> 实例创建表达式较为复杂，所以 widget 构造函数只使用命名的参数。这能让实例创建表达式可读性更高。</p>
<p>你可以在任意的 Dart 代码中使用 <code>@required</code> 来标记命名的参数，从而指定该参数为<em>必需</em>参数。举例：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Scrollbar(&#123;Key key, <span class="meta">@required</span> Widget child&#125;);</span><br></pre></td></tr></table></figure>

<p>当构造一个 <code>Scrollbar</code> 时，如果 <code>child</code> 参数缺省，编译器会报错。</p>
<p><em>Required</em> 定义在 <em>meta</em> 包中。两种方式导入：import <code>package:meta/meta.dart</code> 或导入其它导出 <code>meta</code> 的包。</p>
<h4 id="可选位置参数"><a href="#可选位置参数" class="headerlink" title="可选位置参数 "></a>可选位置参数 <!-- omit in toc --></h4><p>函数参数列表中，将后面的参数用 <code>[]</code> 标记：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> say(<span class="built_in">String</span> from, <span class="built_in">String</span> msg, [<span class="built_in">String</span> device]) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="string">'$from says $msg'</span>;</span><br><span class="line">    <span class="keyword">if</span> (device != <span class="keyword">null</span>) &#123;</span><br><span class="line">        result = <span class="string">'$result with a $device'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不带可选参数的调用：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(say(<span class="string">'Bob'</span>, <span class="string">'Howdy'</span>) == <span class="string">'Bob says Howdy'</span>);</span><br></pre></td></tr></table></figure>

<p>携带可选参数的调用：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(say(<span class="string">'Bob'</span>, <span class="string">'Howdy'</span>, <span class="string">'smoke signal'</span>) == <span class="string">'Bob says Howdy with a smoke signal'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="默认参数值"><a href="#默认参数值" class="headerlink" title="默认参数值 "></a>默认参数值 <!-- omit in toc --></h4><p>函数参数支持给定默认值，包括命名和位置参数。默认值是编译期常量。如果没有主动提供默认值，默认值为 <code>null</code>。</p>
<p>默认值例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Sets the [bold] and [hidden] flags ...</span></span><br><span class="line"><span class="keyword">void</span> enableFlags(&#123;<span class="built_in">bool</span> bold = <span class="keyword">false</span>, <span class="built_in">bool</span> hidden = <span class="keyword">false</span>&#125;) &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bold will be true; hidden will be false.</span></span><br><span class="line">enableFlags(bold: <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>为位置参数提供默认值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> say(<span class="built_in">String</span> from, <span class="built_in">String</span> msg,</span><br><span class="line">    [<span class="built_in">String</span> device = <span class="string">'carrier pigeon'</span>, <span class="built_in">String</span> mood]) &#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="string">'$from says $msg'</span>;</span><br><span class="line">  <span class="keyword">if</span> (device != <span class="keyword">null</span>) &#123;</span><br><span class="line">    result = <span class="string">'$result with a $device'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (mood != <span class="keyword">null</span>) &#123;</span><br><span class="line">    result = <span class="string">'$result (in a $mood mood)'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(say(<span class="string">'Bob'</span>, <span class="string">'Howdy'</span>) ==</span><br><span class="line">    <span class="string">'Bob says Howdy with a carrier pigeon'</span>);</span><br></pre></td></tr></table></figure>

<p>函数参数类型为数组或表类型，也支持默认值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> doStuff(</span><br><span class="line">    &#123;<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; list = <span class="keyword">const</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; gifts = <span class="keyword">const</span> &#123;</span><br><span class="line">      <span class="string">'first'</span>: <span class="string">'paper'</span>,</span><br><span class="line">      <span class="string">'second'</span>: <span class="string">'cotton'</span>,</span><br><span class="line">      <span class="string">'third'</span>: <span class="string">'leather'</span></span><br><span class="line">    &#125;&#125;) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'list:  $list'</span>);</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'gifts: $gifts'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-main-函数"><a href="#6-2-main-函数" class="headerlink" title="6.2 main() 函数"></a>6.2 main() 函数</h3><p>每个应用都有一个顶层的 <code>main()</code> 函数作为程序入口。该函数返回值为 <code>void</code> 并且有一个可选参数，类型为 <code>List&lt;String&gt;</code>。</p>
<p>Web 程序的 <code>main()</code> 函数例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="built_in">querySelector</span>(<span class="string">'#sample_text_id'</span>);</span><br><span class="line">    ..text = <span class="string">'Click me!'</span>;</span><br><span class="line">    ..onClick.listen(reverseText);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>命令行程序的 <code>main()</code> 函数例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Run the app like this: dart args.dart 1 test</span></span><br><span class="line"><span class="keyword">void</span> main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; arguments) &#123;</span><br><span class="line">  <span class="built_in">print</span>(arguments);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assert</span>(arguments.length == <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">assert</span>(<span class="built_in">int</span>.parse(arguments[<span class="number">0</span>]) == <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">assert</span>(arguments[<span class="number">1</span>] == <span class="string">'test'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用 <em>args library</em> 库定义并解析命令行参数。</p>
<h3 id="6-3-一等公民函数"><a href="#6-3-一等公民函数" class="headerlink" title="6.3 一等公民函数"></a>6.3 一等公民函数</h3><p>函数可以作为其它函数的参数，比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> printElement(<span class="built_in">int</span> element) &#123;</span><br><span class="line">  <span class="built_in">print</span>(element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pass printElement as aparameter.</span></span><br><span class="line">list.forEach(printElement);</span><br></pre></td></tr></table></figure>

<p>函数也可以存到变量中，比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loudify = (msg) =&gt; <span class="string">'!!! <span class="subst">$&#123;msg.toUpperCase()&#125;</span>!!!'</span>;</span><br><span class="line"><span class="keyword">assert</span>(loudify(<span class="string">'hello'</span>) == <span class="string">'!!!HELLO!!!'</span>);</span><br></pre></td></tr></table></figure>

<p>上面使用了匿名函数。</p>
<h3 id="6-4-匿名函数"><a href="#6-4-匿名函数" class="headerlink" title="6.4 匿名函数"></a>6.4 匿名函数</h3><p>大多函数都有名字，比如 <code>main()</code> 和 <code>printElement()</code>，一些没有名字的函数叫做 <em>匿名函数(Anonymous funstions)<em>、</em>lambda</em> 或 <em>闭包(closure)</em>。函数存到变量中，可以被添加到集合中或者被移除。</p>
<p>匿名函数和一般函数类似，0个或多个参数，参数间用逗号隔开，支持可选类型标注，参数用 <code>()</code> 包含。</p>
<p>匿名函数如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">([<span class="built_in">Type</span>] param1[, ...]) &#123;</span><br><span class="line">  codeBlock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下例子定义一个匿名函数，函数携带一个未定义类型的参数 <code>item</code>。每遍历一个 list 中元素，函数都会被调用一次，并打印对应元素的信息。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = [<span class="string">'apples'</span>, <span class="string">'bananas'</span>, <span class="string">'oranges'</span>];</span><br><span class="line">list.forEach((item) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;list.indexOf(item)&#125;</span>: $item'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>匿名函数也可以简写成箭头函数。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.forEach((item) =&gt; <span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;list.indexOf(item)&#125;</span>: $item'</span>));</span><br></pre></td></tr></table></figure>

<h3 id="6-5-作用域"><a href="#6-5-作用域" class="headerlink" title="6.5 作用域"></a>6.5 作用域</h3><p>Dart 是一种 <em>lexically scoped language</em>。代码的布局决定了变量的作用域。</p>
<p>以下例子展示了嵌套函数的变量作用域：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> topLevel = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">var</span> insideMain = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> myFunction() &#123;</span><br><span class="line">    <span class="keyword">var</span> insideFunction = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> nestedFunction() &#123;</span><br><span class="line">      <span class="keyword">var</span> insideNestedFunction = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">assert</span>(topLevel);</span><br><span class="line">      <span class="keyword">assert</span>(insideMain);</span><br><span class="line">      <span class="keyword">assert</span>(insideFunction);</span><br><span class="line">      <span class="keyword">assert</span>(insideNestedFunction);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-6-词法闭包"><a href="#6-6-词法闭包" class="headerlink" title="6.6 词法闭包"></a>6.6 词法闭包</h3><p><em>闭包</em> 是函数，能访问作用域内的变量，即使该闭包在原来作用域外部被使用。</p>
<p>函数能延长变量的生命周期。以下例子中，<code>makeAdder()</code> 捕获变量 <code>addBy</code>。当函数执行结束，<code>addBy</code> 被保存到函数中。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Returns a function that adds [addBy] to the</span></span><br><span class="line"><span class="comment">/// function's argument.</span></span><br><span class="line"><span class="built_in">Function</span> makeAdder(<span class="built_in">num</span> addBy) &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">num</span> i) =&gt; addBy + i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="comment">// Create a function that adds 2.</span></span><br><span class="line">  <span class="keyword">var</span> add2 = makeAdder(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a function that adds 4.</span></span><br><span class="line">  <span class="keyword">var</span> add4 = makeAdder(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assert</span>(add2(<span class="number">3</span>) == <span class="number">5</span>);</span><br><span class="line">  <span class="keyword">assert</span>(add4(<span class="number">3</span>) == <span class="number">7</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-7-函数的等价性"><a href="#6-7-函数的等价性" class="headerlink" title="6.7 函数的等价性"></a>6.7 函数的等价性</h3><p>以下例子中，比较了顶层函数，静态方法和实例方法的等价性:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> foo() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> bar() &#123;&#125;</span><br><span class="line">  <span class="keyword">void</span> baz() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">var</span> x;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Comparing top-level functions.</span></span><br><span class="line">  x = foo;</span><br><span class="line">  <span class="built_in">print</span>(foo == x);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Comparing static methods.</span></span><br><span class="line">  x = A.bar;</span><br><span class="line">  <span class="built_in">print</span>(A.bar == x);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Comparing instance methods.</span></span><br><span class="line">  <span class="keyword">var</span> v = A();</span><br><span class="line">  <span class="keyword">var</span> w = A();</span><br><span class="line">  <span class="keyword">var</span> y = w;</span><br><span class="line">  x = w.baz;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(y.baz == x);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(v.baz != w.baz);</span><br><span class="line">&#125;</span><br><span class="line">```Dart</span><br><span class="line"></span><br><span class="line">### <span class="number">6.8</span> 返回值</span><br><span class="line"></span><br><span class="line">所有函数都有返回值。如果没有显示指定，会默认在函数体最后加上 `<span class="keyword">return</span> <span class="keyword">null</span>`。</span><br><span class="line">```Dart</span><br><span class="line">foo() &#123;&#125;</span><br><span class="line"><span class="built_in">print</span>(foo() == <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<h2 id="7-运算符"><a href="#7-运算符" class="headerlink" title="7. 运算符"></a>7. 运算符</h2><table>
<thead>
<tr>
<th align="center">描述</th>
<th align="center">运算符</th>
</tr>
</thead>
<tbody><tr>
<td align="center">一元后缀运算符</td>
<td align="center"><code>expr++</code>, <code>expr--</code>, <code>()</code>, <code>.</code>, <code>?.</code></td>
</tr>
<tr>
<td align="center">一元前缀运算符</td>
<td align="center"><code>-expr</code>, <code>!expr</code>, <code>~expr</code>, <code>++expr</code>, <code>--expr</code></td>
</tr>
<tr>
<td align="center">乘法（multiplicative）</td>
<td align="center"><code>*</code>, <code>/</code>, <code>%</code>, <code>~/</code></td>
</tr>
<tr>
<td align="center">加法</td>
<td align="center"><code>+</code>, <code>-</code></td>
</tr>
<tr>
<td align="center">位移</td>
<td align="center"><code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>&gt;&gt;&gt;</code></td>
</tr>
<tr>
<td align="center">位与</td>
<td align="center"><code>&amp;</code></td>
</tr>
<tr>
<td align="center">位异或</td>
<td align="center"><code>^</code></td>
</tr>
<tr>
<td align="center">位或</td>
<td align="center">`</td>
</tr>
<tr>
<td align="center">关系运算和类型推断</td>
<td align="center"><code>&gt;=</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>as</code>, <code>is</code>, <code>is!</code></td>
</tr>
<tr>
<td align="center">等价</td>
<td align="center"><code>==</code>, <code>!=</code></td>
</tr>
<tr>
<td align="center">逻辑与</td>
<td align="center"><code>&amp;&amp;</code></td>
</tr>
<tr>
<td align="center">逻辑或</td>
<td align="center">`</td>
</tr>
<tr>
<td align="center">可选判断</td>
<td align="center"><code>??</code></td>
</tr>
<tr>
<td align="center">条件</td>
<td align="center"><code>expr1 ? expr2 : expr3</code></td>
</tr>
<tr>
<td align="center">多级</td>
<td align="center"><code>..</code></td>
</tr>
<tr>
<td align="center">赋值</td>
<td align="center"><code>=</code>, <code>*=</code>, <code>/=</code>, <code>+=</code>, <code>-=</code>, <code>&amp;=</code>, <code>^=</code>, etc</td>
</tr>
</tbody></table>
<p>运算符使用例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a++</span><br><span class="line">a + b</span><br><span class="line">a = b</span><br><span class="line">a == b</span><br><span class="line">c ? a : b</span><br><span class="line">a <span class="keyword">is</span> T</span><br></pre></td></tr></table></figure>

<p>上述表中的运算符优先从高到底排列。运算符优先级的作用：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((n % i == <span class="number">0</span>) &amp;&amp; (d % i ) == <span class="number">0</span>) ...</span><br><span class="line"><span class="keyword">if</span> (n % i == <span class="number">0</span> &amp;&amp; d % i == <span class="number">0</span>) ...</span><br></pre></td></tr></table></figure>

<h3 id="7-1-算数运算符"><a href="#7-1-算数运算符" class="headerlink" title="7.1 算数运算符"></a>7.1 算数运算符</h3><p>Dart 支持的算术运算符：<br>|  运算符 | 意义 |<br>| ——: | :— |<br>|     <code>+</code> | 加   |<br>|     <code>-</code> | 减   |<br>| <code>-expr</code> | 负号 |<br>|     <code>*</code> | 乘   |<br>|     <code>/</code> | 除   |<br>|    <code>~/</code> | 取商 |<br>|     <code>%</code> | 取模 |</p>
<p>Dart 支持的递增/递减运算符：<br>| 运算符  |                  意义                   |<br>| :—–: | :————————————-: |<br>| <code>++var</code> |  <code>var = var + 1</code>(表达式的值是加后的值)  |<br>| <code>var++</code> | <code>var = var + 1</code>（表达式的值是加前的值） |<br>| <code>--var</code> | <code>var = var - 1</code>（表达式的值是减后的值） |<br>| <code>var--</code> | <code>var = var - 1</code>（表达式的值是减前的值） |</p>
<h3 id="7-2-关系运算法"><a href="#7-2-关系运算法" class="headerlink" title="7.2 关系运算法"></a>7.2 关系运算法</h3><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>==</code></td>
<td align="center">相等</td>
</tr>
<tr>
<td align="center"><code>!=</code></td>
<td align="center">不等</td>
</tr>
<tr>
<td align="center"><code>&gt;</code></td>
<td align="center">大于</td>
</tr>
<tr>
<td align="center"><code>&lt;</code></td>
<td align="center">小于</td>
</tr>
<tr>
<td align="center"><code>&gt;=</code></td>
<td align="center">大于等于</td>
</tr>
<tr>
<td align="center"><code>&lt;=</code></td>
<td align="center">小于等于</td>
</tr>
</tbody></table>
<h3 id="7-3-类型推断运算符"><a href="#7-3-类型推断运算符" class="headerlink" title="7.3 类型推断运算符"></a>7.3 类型推断运算符</h3><p>运行时用于类型校验：<br>| 运算符 |               意义               |<br>| :—-: | :——————————: |<br>|  <code>as</code>  | 类型推断(类型推断错误会抛出异常) |<br>|  <code>is</code>  |    对象是指定类型时返回 true     |<br>| <code>is!</code>  |   对象不是指定类型时返回 true    |</p>
<h3 id="7-4-赋值运算符"><a href="#7-4-赋值运算符" class="headerlink" title="7.4 赋值运算符"></a>7.4 赋值运算符</h3><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>=</code></td>
<td><code>-=</code></td>
<td><code>/=</code></td>
<td><code>%\</code></td>
<td><code>&gt;&gt;=</code></td>
<td><code>^=</code></td>
</tr>
<tr>
<td><code>+=</code></td>
<td><code>*=</code></td>
<td><code>~/=</code></td>
<td><code>&lt;&lt;=</code></td>
<td><code>&amp;=</code></td>
<td>`</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">联合赋值</th>
<th align="center">等价表达式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">op</td>
<td align="center"><code>a op= b</code></td>
<td align="center"><code>a= a op b</code></td>
</tr>
<tr>
<td align="center">例子</td>
<td align="center"><code>a += b</code></td>
<td align="center"><code>a = a + b</code></td>
</tr>
</tbody></table>
<h3 id="7-5-逻辑运算符"><a href="#7-5-逻辑运算符" class="headerlink" title="7.5 逻辑运算符"></a>7.5 逻辑运算符</h3><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>!expr</code></td>
<td align="center">逻辑非</td>
</tr>
<tr>
<td align="center">`</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>&amp;&amp;</code></td>
<td align="center">逻辑与</td>
</tr>
</tbody></table>
<h3 id="7-6-位移运算符"><a href="#7-6-位移运算符" class="headerlink" title="7.6 位移运算符"></a>7.6 位移运算符</h3><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>&amp;</code></td>
<td align="center">位与</td>
</tr>
<tr>
<td align="center">`</td>
<td align="center">`</td>
</tr>
<tr>
<td align="center"><code>^</code></td>
<td align="center">位异或（相同为0，不同为1）</td>
</tr>
<tr>
<td align="center"><code>~expr</code></td>
<td align="center">位取反（0-&gt;1, 1-&gt;0）</td>
</tr>
<tr>
<td align="center"><code>&lt;&lt;</code></td>
<td align="center">左移一位</td>
</tr>
<tr>
<td align="center"><code>&gt;&gt;</code></td>
<td align="center">右移一位</td>
</tr>
</tbody></table>
<h3 id="7-7-条件表达式"><a href="#7-7-条件表达式" class="headerlink" title="7.7 条件表达式"></a>7.7 条件表达式</h3><p>Dart 支持两个条件表达式：</p>
<p><code>condition ? expr1 : expr2</code><br><br>如果条件为真，执行表达式1并返回结果；否则，执行表达式2并返回结果。</p>
<p><code>expr1 ?? expr2</code><br><br>如果表达式1非空，返回其值；否则，执行表达式2并返回结果。</p>
<h3 id="7-8-多级表示法"><a href="#7-8-多级表示法" class="headerlink" title="7.8 多级表示法"></a>7.8 多级表示法</h3><p>连续调用相同对象，使用 <code>..</code> 可以简化写法，减少使用临时变量。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">querySelector</span>(<span class="string">'#confirm'</span>)</span><br><span class="line">  ..text = <span class="string">'Confirm'</span></span><br><span class="line">  ..classes.add(<span class="string">'important'</span>)</span><br><span class="line">  ..onClick.listen((e) =&gt; <span class="built_in">window</span>.alert(<span class="string">'Confirm!'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于以下写法</span></span><br><span class="line"><span class="keyword">var</span> button = <span class="built_in">querySelector</span>(<span class="string">'#confirm'</span>);</span><br><span class="line">button.text = <span class="string">'Confirm'</span>;</span><br><span class="line">button.classes.add(<span class="string">'important'</span>);</span><br><span class="line">button.onClick.listen((e) =&gt; <span class="built_in">window</span>.alert(<span class="string">'Confirmed!'</span>));</span><br></pre></td></tr></table></figure>

<p>嵌套写法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> addressBook = (</span><br><span class="line">  AddressBookBuilder()</span><br><span class="line">    ..name = <span class="string">'jenny'</span></span><br><span class="line">    ..email = <span class="string">'jenny@example.com'</span></span><br><span class="line">    ..phone = (</span><br><span class="line">      PhoneNumberBuilder()</span><br><span class="line">        ..number = <span class="string">'xxx-xxx-xxxx'</span></span><br><span class="line">        ..label = <span class="string">'home'</span></span><br><span class="line">      .build();</span><br><span class="line">    )</span><br><span class="line">  .build();</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="7-9-其它"><a href="#7-9-其它" class="headerlink" title="7.9 其它"></a>7.9 其它</h3><p>其他运算符：<br>| 运算符 |         名字         |                  意义                   |<br>| :—-: | :——————: | :————————————-: |<br>|  <code>()</code>  | Function application |              表示调用函数               |<br>|  <code>[]</code>  |       访问数组       |      引用数组指定索引位置上的元素       |<br>|  <code>.</code>   |     访问成员变量     |             表达式访问属性              |<br>|  <code>?.</code>  |   条件访问成员变量   | 类似 <code>.</code>，支持空对象(类似 Swift 可选链) |</p>
<h2 id="8-控制语句"><a href="#8-控制语句" class="headerlink" title="8. 控制语句"></a>8. 控制语句</h2><p>Dart 控制流：</p>
<ul>
<li><code>if else</code></li>
<li><code>switch case</code></li>
<li><code>while</code> &amp; <code>do-while</code></li>
<li><code>break</code> &amp; <code>continue</code></li>
<li><code>for</code> 循环</li>
<li><code>assert</code></li>
</ul>
<p>另外，还有 <code>try-catch</code> 和 <code>throw</code>。</p>
<h3 id="8-1-If-else"><a href="#8-1-If-else" class="headerlink" title="8.1 If else"></a>8.1 If else</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isRaining()) &#123;</span><br><span class="line">  you.bringRainCoat();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (isSnowing()) &#123;</span><br><span class="line">  you.wearJacket();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  car.putTopDown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不同于 JS 的地方， Dart 条件必须是布尔值。</p>
<h3 id="8-2-For-循环"><a href="#8-2-For-循环" class="headerlink" title="8.2 For 循环"></a>8.2 For 循环</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> msg = <span class="built_in">StringBuffer</span>(<span class="string">'Dart is fun'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  msg.write(<span class="string">'!'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>闭包捕获变量，并在内部拷贝，即使 <code>i</code> 改变也不会影响之前的值： </p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> callbacks = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i&lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">  callbacks.append(() =&gt; <span class="built_in">print</span>(i));</span><br><span class="line">&#125;</span><br><span class="line">callbacks.forEach((c) =&gt; c()); <span class="comment">// Dart 输出 0, 1； JS 输出 2, 2</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-While-amp-do-while"><a href="#8-3-While-amp-do-while" class="headerlink" title="8.3 While &amp; do-while"></a>8.3 While &amp; do-while</h3><p><code>while</code> 在进入循环体之前判断条件：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!isDone()) &#123;</span><br><span class="line">  doSomething();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>do-while</code> 先执行循环体再判断条件：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  printLine();</span><br><span class="line">&#125; <span class="keyword">while</span>(!atEndOfPage())</span><br></pre></td></tr></table></figure>

<h3 id="8-4-Break-amp-continue"><a href="#8-4-Break-amp-continue" class="headerlink" title="8.4 Break &amp; continue"></a>8.4 Break &amp; continue</h3><ul>
<li><code>break</code> 跳出循环</li>
<li><code>continue</code> 跳过当前循环</li>
</ul>
<h3 id="8-5-Switch-case"><a href="#8-5-Switch-case" class="headerlink" title="8.5 Switch case"></a>8.5 Switch case</h3><p>Dart switch 支持整型，字符串和编译期常量。对象必须是相同类型且该类没有重载 <code>==</code>。</p>
<p>每个非空的 <code>case</code> 从句，必须要有 <code>break</code>。其他结束 <code>case</code> 的语句：<code>continue</code>, <code>return</code> 和 <code>throw</code>。</p>
<p>非空的 <code>case</code> 中省略 <code>break</code> 会报编译错误：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> command = <span class="string">'OPEN'</span>;</span><br><span class="line"><span class="keyword">switch</span> (command) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'OPEN'</span>:</span><br><span class="line">  executeOpen();</span><br><span class="line">  <span class="comment">// Error: Missing break</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'CLOSE'</span>:</span><br><span class="line">  executeClose();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>case</code> 可以为空：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> command = <span class="string">'OPEN'</span>;</span><br><span class="line"><span class="keyword">switch</span> (command) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'OPEN'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'NOW_CLOSED'</span>:</span><br><span class="line">  executeNowClosed();</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Dart 支持 <code>continue</code> 加标签的方式控制代码执行：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> command = <span class="string">'CLOSED'</span>;</span><br><span class="line"><span class="keyword">switch</span> (command) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'CLOSED'</span>:</span><br><span class="line">    executeClosed();</span><br><span class="line">    <span class="keyword">continue</span> nowClosed;</span><br><span class="line">  <span class="comment">// Continues executing at the nowClosed label.</span></span><br><span class="line"></span><br><span class="line">  nowClosed:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'NOW_CLOSED'</span>:</span><br><span class="line">    <span class="comment">// Runs for both CLOSED and NOW_CLOSED.</span></span><br><span class="line">    executeNowClosed();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>case</code> 内部可以定义局部变量，变量作用域仅限此代码块。</p>
<h3 id="8-6-断言"><a href="#8-6-断言" class="headerlink" title="8.6 断言"></a>8.6 断言</h3><p>开发者模式下，支持 <code>assert(condition, optionalMessage)</code> 终止程序。</p>
<h2 id="9-异常处理"><a href="#9-异常处理" class="headerlink" title="9. 异常处理"></a>9. 异常处理</h2><p>Dart 支持异常捕获机制。异常是程序运行过程中不可知的错误。如果程序没有捕获异常，抛出异常的<a href="https://zhuanlan.zhihu.com/p/40069285" target="_blank" rel="noopener"><strong>isolate</strong></a> 会被挂起，通常情况下，isolate 和程序都会被终止。</p>
<p>不同于 Java， Dart 的异常都是未经检查的。方法不会声明可能的异常，并且不需要去处理。</p>
<p>Dart 提供了 <em>Exception<em>，</em>Error</em> 以及其他的子类。开发者可以自定义异常。另外，Dart 程序可以把所有非空对象作为异常抛出。</p>
<h3 id="9-1-Throw"><a href="#9-1-Throw" class="headerlink" title="9.1 Throw"></a>9.1 Throw</h3><p>抛出异常的例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> FormatException(<span class="string">'Expected at least 1 section'</span>);</span><br></pre></td></tr></table></figure>

<p>抛出任意非空对象作为异常：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="string">'Out of llamas'</span>;</span><br></pre></td></tr></table></figure>

<p>因为抛出异常是一个表达式，所以可以出现在任何需要表达式的位置：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> distanceTo(Point point) =&gt; <span class="keyword">throw</span> UnimplementedError();</span><br></pre></td></tr></table></figure>

<h3 id="9-2-Catch"><a href="#9-2-Catch" class="headerlink" title="9.2 Catch"></a>9.2 Catch</h3><p>捕获异常能停止异常的传递，给程序处理异常的能力：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  breedMoreLlamas();</span><br><span class="line">&#125; on OutOfLlamasException &#123;</span><br><span class="line">  buyMoreLlammas();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于能抛出多种异常类型的代码，可以使用多个 catch 从句。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  breedMoreLlamas();</span><br><span class="line">&#125; on OutOfLlamasException &#123;</span><br><span class="line">  <span class="comment">// A specific exception</span></span><br><span class="line">  buyMoreLlamas();</span><br><span class="line">&#125; on Exception <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// Anything else that is an exception</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Unknown exception: $e'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// No specified type, handles all</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Something really unknown: $e'</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><code>catch()</code> 可以指定两个参数，第一个是抛出的异常，第二个是栈回溯(<a href="https://api.dart.dev/stable/dart-core/StackTrace-class.html" target="_blank" rel="noopener">StackTrace</a>)。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// ···</span></span><br><span class="line">&#125; on Exception <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Exception details:\n $e'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e, s) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Exception details:\n $e'</span>);</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Stack trace:\n $s'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在当前位置处理异常并继续传递，使用 <code>rethrow</code> 关键字：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> misbehave() &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">dynamic</span> foo = <span class="keyword">true</span>;</span><br><span class="line">    <span class="built_in">print</span>(foo++); <span class="comment">// Runtime error</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'misbehave() partially handled <span class="subst">$&#123;e.runtimeType&#125;</span>.'</span>);</span><br><span class="line">    <span class="keyword">rethrow</span>; <span class="comment">// Allow callers to see the exception.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    misbehave();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'main() finished handling <span class="subst">$&#123;e.runtimeType&#125;</span>.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-Finally"><a href="#9-3-Finally" class="headerlink" title="9.3 Finally"></a>9.3 Finally</h3><p>无论是否抛出异常，使用finally子句，确保代码运行。如果 <code>catch</code> 没有匹配到异常，该异常会在 <code>finally</code> 后继续传播：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  breedMoreLlamas();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="comment">// Always clean up, even if an exception is thrown.</span></span><br><span class="line">  cleanLlamaStalls();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>catch</code> 匹配到异常后，也会执行 <code>finally</code> 从句：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  breedMoreLlamas();</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Error: $e'</span>); <span class="comment">// Handle the exception first.</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  cleanLlamaStalls(); <span class="comment">// Then clean up.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-类"><a href="#10-类" class="headerlink" title="10. 类"></a>10. 类</h2><p>Dart 是面向对象语言，具有类和基于 mixin 的继承。每个对象都是类的实例，每个类继承自 <em>Object*。基于 *mixin</em> 的继承意味着类只有一个超类，但是类的成员可被多个类结构重用。</p>
<h3 id="10-1-使用类成员变量"><a href="#10-1-使用类成员变量" class="headerlink" title="10.1 使用类成员变量"></a>10.1 使用类成员变量</h3><p>对象的成员由函数和数据组成。当一个方法被调用时，也就是调用对象的某个方法：通过对象的函数和数据获取方法。</p>
<p>使用 <code>.</code> 引用实例变量或方法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = Point(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set the value of the instance variable y.</span></span><br><span class="line">p.y = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the value of y.</span></span><br><span class="line"><span class="keyword">assert</span>(p.y == <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Invoke distanceTo() on p.</span></span><br><span class="line"><span class="built_in">num</span> distance = p.distanceTo(Point(<span class="number">4</span>, <span class="number">4</span>));</span><br></pre></td></tr></table></figure>

<p>使用 <code>?.</code> 避免调用链为 null 时产生异常：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If p is non-null, set its y value to 4.</span></span><br><span class="line">p?.y = <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-使用构造函数"><a href="#10-2-使用构造函数" class="headerlink" title="10.2 使用构造函数"></a>10.2 使用构造函数</h3><p>使用构造器构造对象。构造器命名可以是 <code>ClassName</code> 或 <code>ClassName.identifier</code>。比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = Point(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> p2 = Point.fromJson(&#123;<span class="string">'x'</span>: <span class="number">1</span>, <span class="string">'y'</span>: <span class="number">2</span>&#125;);</span><br></pre></td></tr></table></figure>

<p>以下代码效果相同，构造器前面多一个可选的 <code>new</code> 关键字：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> Point(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> Point.fromJson(&#123;<span class="string">'x'</span>: <span class="number">1</span>, <span class="string">'y'</span>: <span class="number">2</span>&#125;);</span><br></pre></td></tr></table></figure>

<p>部分类提供了<a href="https://dart.dev/guides/language/language-tour#constant-constructors" target="_blank" rel="noopener">常量构造器</a>。构造器前加 <code>const</code> 修饰，以创建编译期常量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">const</span> ImmutablePoint(<span class="number">2</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>构造两个等价的编译期常量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">const</span> ImmutablePoint(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">const</span> ImmutablePoint(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(identical(a, b)); <span class="comment">// They are the same instance!</span></span><br></pre></td></tr></table></figure>

<p>如果能通过上下文推断出是常量，则可省略 <code>const</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lots of const keywords here.</span></span><br><span class="line"><span class="keyword">const</span> pointAndLine = <span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="string">'point'</span>: <span class="keyword">const</span> [<span class="keyword">const</span> ImmutablePoint(<span class="number">0</span>, <span class="number">0</span>)],</span><br><span class="line">  <span class="string">'line'</span>: <span class="keyword">const</span> [<span class="keyword">const</span> ImmutablePoint(<span class="number">1</span>, <span class="number">10</span>), <span class="keyword">const</span> ImmutablePoint(<span class="number">-2</span>, <span class="number">11</span>)],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以简写为：</span></span><br><span class="line"><span class="comment">// Only one const, which establishes the constant context.</span></span><br><span class="line"><span class="keyword">const</span> pointAndLine = &#123;</span><br><span class="line">  <span class="string">'point'</span>: [ImmutablePoint(<span class="number">0</span>, <span class="number">0</span>)],</span><br><span class="line">  <span class="string">'line'</span>: [ImmutablePoint(<span class="number">1</span>, <span class="number">10</span>), ImmutablePoint(<span class="number">-2</span>, <span class="number">11</span>)],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果一个常量构造器超出常量上下文，并且没用 <code>const</code> 修饰，则创建一个非常量对象：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">const</span> ImmutablePoint(<span class="number">1</span>, <span class="number">1</span>); <span class="comment">// Creates a constant</span></span><br><span class="line"><span class="keyword">var</span> b = ImmutablePoint(<span class="number">1</span>, <span class="number">1</span>); <span class="comment">// Does NOT create a constant</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(!identical(a, b)); <span class="comment">// NOT the same instance!</span></span><br></pre></td></tr></table></figure>

<h3 id="10-3-获取对象类型"><a href="#10-3-获取对象类型" class="headerlink" title="10.3 获取对象类型"></a>10.3 获取对象类型</h3><p>使用 Object <code>runtimeType</code> 属性，在运行时获取对象类型，返回 <code>Type</code> 对象：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">'The type of a is <span class="subst">$&#123;a.runtimeType&#125;</span>'</span>);</span><br></pre></td></tr></table></figure>

<p>以上内容介绍了如何<em>使用</em>类，下面介绍如何实现类。</p>
<h3 id="10-4-实例变量"><a href="#10-4-实例变量" class="headerlink" title="10.4 实例变量"></a>10.4 实例变量</h3><p>如何声明一个实例变量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> x; <span class="comment">// Declare instance variable x, initially null.</span></span><br><span class="line">  <span class="built_in">num</span> y; <span class="comment">// Declare y, initially null.</span></span><br><span class="line">  <span class="built_in">num</span> z = <span class="number">0</span>; <span class="comment">// Declare z, initially 0.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>未初始化的实例变量默认为 <code>null</code>。</p>
<p>所以实例变量隐式生成 <em>getter</em> 方法。所有实例变量（除了 final）隐式生成 <em>setter</em> 方法。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> x;</span><br><span class="line">  <span class="built_in">num</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">var</span> point = Point();</span><br><span class="line">  point.x = <span class="number">4</span>; <span class="comment">// Use the setter method for x.</span></span><br><span class="line">  <span class="keyword">assert</span>(point.x == <span class="number">4</span>); <span class="comment">// Use the getter method for x.</span></span><br><span class="line">  <span class="keyword">assert</span>(point.y == <span class="keyword">null</span>); <span class="comment">// Values default to null.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于实例变量的生命周期，实例变量在构造器和初始化器执行之前就已创建，如果声明实例变量的时候手动初始化了，那么初始化也在此时完成。</p>
<h3 id="10-5-构造函数"><a href="#10-5-构造函数" class="headerlink" title="10.5 构造函数"></a>10.5 构造函数</h3><p>构造器写法：声明一个函数，函数名和类名相同。最常见的构造器形式就是生成构造器，会创建类的一个新实例：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> x, y;</span><br><span class="line"></span><br><span class="line">  Point(<span class="built_in">num</span> x, <span class="built_in">num</span> y) &#123;</span><br><span class="line">    <span class="comment">// There's a better way to do this, stay tuned.</span></span><br><span class="line">    <span class="keyword">this</span>.x = x;</span><br><span class="line">    <span class="keyword">this</span>.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>this</code> 关键字引用当前实例。</p>
<p>构造器的一个语法糖写法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> x, y;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Syntactic sugar for setting x and y</span></span><br><span class="line">  <span class="comment">// before the constructor body runs.</span></span><br><span class="line">  Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="默认构造器"><a href="#默认构造器" class="headerlink" title="默认构造器 "></a>默认构造器 <!-- omit in toc --></h4><p>如果没有生命构造器，Dart 会默认生成一个构造器。此构造器没有参数，并调用父类的不带参构造器。</p>
<h4 id="构造器不继承"><a href="#构造器不继承" class="headerlink" title="构造器不继承 "></a>构造器不继承 <!-- omit in toc --></h4><p>构造器不支持继承。</p>
<h4 id="带名字的构造器"><a href="#带名字的构造器" class="headerlink" title="带名字的构造器 "></a>带名字的构造器 <!-- omit in toc --></h4><p>如果需要创建多个构造器，使用带名字的构造器：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> x, y;</span><br><span class="line"></span><br><span class="line">  Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Named constructor</span></span><br><span class="line">  Point.origin() &#123;</span><br><span class="line">    x = <span class="number">0</span>;</span><br><span class="line">    y = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="调用非默认的父类构造器"><a href="#调用非默认的父类构造器" class="headerlink" title="调用非默认的父类构造器 "></a>调用非默认的父类构造器 <!-- omit in toc --></h4><p>默认情况下，子类的构造器调用父类不带名字和参数的构造器，且在子类构造器的头部调用。如果使用了<a href="https://dart.dev/guides/language/language-tour#initializer-list" target="_blank" rel="noopener">初始化列表</a>，此操作会在父类调用前执行。三者顺序：</p>
<ol>
<li>初始化列表</li>
<li>父类无参构造器</li>
<li>当前类无参构造器</li>
</ol>
<p>如果父类没有无名无参的构造器，必须手动调用父类的一个构造器。在 <code>:</code> 和函数体之间指定父类的构造器。比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> firstName;</span><br><span class="line"></span><br><span class="line">  Person.fromJson(<span class="built_in">Map</span> data) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'in Person'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Person does not have a default constructor;</span></span><br><span class="line">  <span class="comment">// you must call super.fromJson(data).</span></span><br><span class="line">  Employee.fromJson(<span class="built_in">Map</span> data) : <span class="keyword">super</span>.fromJson(data) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'in Employee'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">  <span class="keyword">var</span> emp = <span class="keyword">new</span> Employee.fromJson(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Prints:</span></span><br><span class="line">  <span class="comment">// in Person</span></span><br><span class="line">  <span class="comment">// in Employee</span></span><br><span class="line">  <span class="keyword">if</span> (emp <span class="keyword">is</span> Person) &#123;</span><br><span class="line">    <span class="comment">// Type check</span></span><br><span class="line">    emp.firstName = <span class="string">'Bob'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  (emp <span class="keyword">as</span> Person).firstName = <span class="string">'Bob'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="初始化列表"><a href="#初始化列表" class="headerlink" title="初始化列表 "></a>初始化列表 <!-- omit in toc --></h4><p>除了调用父类构造器外，还可以在构造器函数体之前初始化实例变量。多个初始化之间用逗号分隔：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Point.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">num</span>&gt; json) : x = json[<span class="string">'x'</span>], y = json[<span class="string">'y'</span>] &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'In Point.fromJson(): ($x, $y)'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开发模式下，初始化列表中可使用断言：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Point.withAssert(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y) : <span class="keyword">assert</span>(x &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'In Point.withAssert(): ($x, $y)'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置 final 字段时，初始化列表较为便利。比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> x;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> y;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> distanceFromOrigin;</span><br><span class="line"></span><br><span class="line">  Point(x, y)</span><br><span class="line">      : x = x,</span><br><span class="line">        y = y,</span><br><span class="line">        distanceFromOrigin = sqrt(x * x + y * y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> Point(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">  <span class="built_in">print</span>(p.distanceFromOrigin);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重定向构造器"><a href="#重定向构造器" class="headerlink" title="重定向构造器 "></a>重定向构造器 <!-- omit in toc --></h4><p>部分构造器的作用只是调用当前类的其它构造器。重定向构造器写法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> x, y;</span><br><span class="line"></span><br><span class="line">  Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line"></span><br><span class="line">  Point.alongzXAxis(<span class="built_in">num</span> x) : <span class="keyword">this</span>(x, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="常量构造器"><a href="#常量构造器" class="headerlink" title="常量构造器 "></a>常量构造器 <!-- omit in toc --></h4><p>常量构造器用来表示类生成的实例不会改变。用 <code>const</code> 修饰构造器且全部实例变量使用 <code>final</code>。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImmutablePoint</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> ImmutablePoint origin = <span class="keyword">const</span> ImmutablePoint(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> x, y;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ImmutablePoint(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常量构造器不一定总是创建常量。更多信息查看<a href="https://dart.dev/guides/language/language-tour#using-constructors" target="_blank" rel="noopener">文档</a>。</p>
<h4 id="工厂构造器"><a href="#工厂构造器" class="headerlink" title="工厂构造器 "></a>工厂构造器 <!-- omit in toc --></h4><p>关键字 <code>factory</code> 修饰的构造器表示，此构造器不会每次都创建新的实例。比如，工厂构造器可能返回一个缓存中的实例或者子类的实例。</p>
<p>工厂构造器写法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> name;</span><br><span class="line">  <span class="built_in">bool</span> mute = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// _cache is library-private, thanks to</span></span><br><span class="line">  <span class="comment">// the _ in front of its name.</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Logger&gt; _cache =</span><br><span class="line">      &lt;<span class="built_in">String</span>, Logger&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Logger(<span class="built_in">String</span> name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_cache.containsKey(name)) &#123;</span><br><span class="line">      <span class="keyword">return</span> _cache[name];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> logger = Logger._internal(name);</span><br><span class="line">      _cache[name] = logger;</span><br><span class="line">      <span class="keyword">return</span> logger;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Logger._internal(<span class="keyword">this</span>.name);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> log(<span class="built_in">String</span> msg) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!mute) <span class="built_in">print</span>(msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用工厂构造器同其他构造器方法一样：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> logger = Logger(<span class="string">'UI'</span>);</span><br><span class="line">logger.log(<span class="string">'Button clicked'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="10-6-方法"><a href="#10-6-方法" class="headerlink" title="10.6 方法"></a>10.6 方法</h3><p>方法是定义在类内部的函数。</p>
<h4 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法 "></a>实例方法 <!-- omit in toc --></h4><p>对象的实例方法内部可访问实例变量和 <code>this</code>。例子如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> x, y;</span><br><span class="line"></span><br><span class="line">  Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">num</span> distanceTo(Point other) &#123;</span><br><span class="line">    <span class="keyword">var</span> dx = x - other.x;</span><br><span class="line">    <span class="keyword">var</span> dy = y - other.y;</span><br><span class="line">    <span class="keyword">return</span> sqrt(dx * dx + dy * dy);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Getters-amp-setters"><a href="#Getters-amp-setters" class="headerlink" title="Getters &amp; setters "></a>Getters &amp; setters <!-- omit in toc --></h4><p>Getters 和 setters 是特殊的方法，能读写对象属性。实例变量默认都有 getter，通常也有 setter。也可用 <code>get</code> 和 <code>set</code> 自己实现：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> left, top, width, height;</span><br><span class="line"></span><br><span class="line">  Rectangle(<span class="keyword">this</span>.left, <span class="keyword">this</span>.top, <span class="keyword">this</span>.width, <span class="keyword">this</span>.height);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Define two calculated properties: right and bottom.</span></span><br><span class="line">  <span class="built_in">num</span> <span class="keyword">get</span> right =&gt; left + width;</span><br><span class="line">  <span class="keyword">set</span> right(<span class="built_in">num</span> value) =&gt; left = value - width;</span><br><span class="line">  <span class="built_in">num</span> <span class="keyword">get</span> bottom =&gt; top + height;</span><br><span class="line">  <span class="keyword">set</span> bottom(<span class="built_in">num</span> value) =&gt; top = value - height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">var</span> rect = Rectangle(<span class="number">3</span>, <span class="number">4</span>, <span class="number">20</span>, <span class="number">15</span>);</span><br><span class="line">  <span class="keyword">assert</span>(rect.left == <span class="number">3</span>);</span><br><span class="line">  rect.right = <span class="number">12</span>;</span><br><span class="line">  <span class="keyword">assert</span>(rect.left == <span class="number">-8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抽象方法"><a href="#抽象方法" class="headerlink" title="抽象方法 "></a>抽象方法 <!-- omit in toc --></h4><p>实例方法，getter 和 setter 都能定义为抽象方法，当前类只定义接口，实现交由其它类。抽象方法只能定义在<a href="https://dart.dev/guides/language/language-tour#abstract-classes" target="_blank" rel="noopener">抽象类</a>中。</p>
<p>定义抽象方法，用分号替代函数体：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Doer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">void</span> soSomething();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EffectiveDoer</span> <span class="keyword">extends</span> <span class="title">Doer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">void</span> soSomething() &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-7-抽象类"><a href="#10-7-抽象类" class="headerlink" title="10.7 抽象类"></a>10.7 抽象类</h3><p>关键字 <code>abstract</code> 定义<em>抽象类</em>（不能被实例化）。抽象类多用于接口定义，实现较多的情况。定义<a href="https://dart.dev/guides/language/language-tour#factory-constructors" target="_blank" rel="noopener">工厂构造器</a>可实例化抽象类。</p>
<p>抽象类通常都有抽象方法，例子如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This class is declared abstract and thus</span></span><br><span class="line"><span class="comment">// can't be instantiated.</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractContainer</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Define constructors, fields, methods...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> updateChildren(); <span class="comment">// Abstract method.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-8-隐式接口"><a href="#10-8-隐式接口" class="headerlink" title="10.8 隐式接口"></a>10.8 隐式接口</h3><p>类隐式定义了一个接口列表，包括当前类实现的所有成员变量。类 A 在不继承类 B 的情况下，实现类 B 的接口，从而调用类 B 的成员。</p>
<p>声明类的时候用 <code>implements</code> 并提供所需的 APIs，从而实现一个或多个接口：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> _name;</span><br><span class="line"></span><br><span class="line">  Person(<span class="keyword">this</span>._name);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> greet(<span class="built_in">String</span> who) =&gt; <span class="string">'Hello, $who. I am $_name'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Impostor</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> _name =&gt; <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> greet(<span class="built_in">String</span> who) =&gt; <span class="string">'Hi $who. Do you know who I am?'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span> greetBob(Person person) =&gt; person.greet(<span class="string">'Bob'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="built_in">print</span>(greetBob(Person(<span class="string">'Kathy'</span>))); <span class="comment">// 'Hello, Bob. I am $Kathy'</span></span><br><span class="line">  <span class="built_in">print</span>(geetBob(Impostor())); <span class="comment">// 'Hi Bob. Do you know who I am?'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个类实现多个接口：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> <span class="keyword">implements</span> <span class="title">Comparable</span>, <span class="title">Location</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-9-扩展类"><a href="#10-9-扩展类" class="headerlink" title="10.9 扩展类"></a>10.9 扩展类</h3><p>使用 <code>extends</code> 创建子类，<code>super</code> 指向父类：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Television</span> </span>&#123;</span><br><span class="line">  <span class="keyword">void</span> turnOn() &#123;</span><br><span class="line">    _illuminateDisplay();</span><br><span class="line">    _activateIrSensor();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ···</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmartTelevision</span> <span class="keyword">extends</span> <span class="title">Television</span> </span>&#123;</span><br><span class="line">  <span class="keyword">void</span> turnOn() &#123;</span><br><span class="line">    <span class="keyword">super</span>.turnOn();</span><br><span class="line">    _bootNetworkInterface();</span><br><span class="line">    _initializeMemory();</span><br><span class="line">    _upgradeApps();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ···</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重写成员"><a href="#重写成员" class="headerlink" title="重写成员 "></a>重写成员 <!-- omit in toc --></h4><p>子类可重载实例方法、getters 和 setters。<code>@override</code> 关键字表示成员被重载：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmartTelevision</span> <span class="keyword">extends</span> <span class="title">Television</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> turnOn() &#123;...&#125;</span><br><span class="line">  <span class="comment">// ···</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="可重载运算符"><a href="#可重载运算符" class="headerlink" title="可重载运算符 "></a>可重载运算符 <!-- omit in toc --></h4><p>下表中运算符支持重载：<br>|       |       |       |       |<br>| :—: | :—: | :—: | :—: |<br>|  <code>&lt;</code>  |  <code>+</code>  |  <code>|</code>  | <code>[]</code>  |<br>|  <code>&gt;</code>  |  <code>/</code>  |  <code>^</code>  | <code>[]=</code> |<br>| <code>&lt;=</code>  | <code>~/</code>  |  <code>&amp;</code>  |  <code>~</code>  |<br>| <code>&gt;=</code>  |  <code>*</code>  | <code>&lt;&lt;</code>  | <code>==</code>  |<br>|  <code>-</code>  |  <code>%</code>  | <code>&gt;&gt;</code>  |       |</p>
<p>重载 <code>+</code>, <code>-</code> 运算符：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vector</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> x, y;</span><br><span class="line"></span><br><span class="line">  Vector(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line"></span><br><span class="line">  Vector <span class="keyword">operator</span> +(Vector v) =&gt; Vector(x + v.x, y + v.y);</span><br><span class="line">  Vector <span class="keyword">operator</span> -(Vector v) =&gt; Vector(x - v.x, y - v.y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">final</span> v = Vector(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">final</span> w = Vector(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assert</span>(v + w == Vector(<span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">  <span class="keyword">assert</span>(v - w == Vector(<span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="noSuchMethod"><a href="#noSuchMethod" class="headerlink" title="noSuchMethod() "></a>noSuchMethod() <!-- omit in toc --></h4><p>重载 <code>noSuchMethod()</code> 方法，及时处理调用对象不存在的实例变量和方法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Unless you override noSuchMethod, using a</span></span><br><span class="line">  <span class="comment">// non-existent member results in a NoSuchMethodError.</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> noSuchMethod(Invocation invocation) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'You tried to use a non-existent member: '</span> +</span><br><span class="line">        <span class="string">'<span class="subst">$&#123;invocation.memberName&#125;</span>'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不可调用对象未实现的方法，除非实现以下任意情况：</p>
<ul>
<li>消息接受者有静态类型 <code>dynamic</code></li>
<li>接收器有一个定义未实现方法的静态类型（包括抽象类型），接收器的动态类型有一个noSuchMethod（）实现，它与Object类中的实现不同。</li>
</ul>
<h3 id="10-10-枚举类型"><a href="#10-10-枚举类型" class="headerlink" title="10.10 枚举类型"></a>10.10 枚举类型</h3><p>枚举表示固定数量的常量值。</p>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法 "></a>用法 <!-- omit in toc --></h4><p>使用 <code>enum</code> 关键字声明枚举类型：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Color &#123; red, green, blue &#125;</span><br></pre></td></tr></table></figure>

<p>枚举值有个 <code>index</code> getter，返回该值在枚举声明中的位置，从 0 开始。第一个值为 0，第二个值为 1…</p>
<p>使用 <code>values</code> 在运行时获取所有枚举值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;Color&gt; colors = Color.values;</span><br><span class="line"><span class="keyword">assert</span>(colors[<span class="number">2</span>] == Color.blue);</span><br></pre></td></tr></table></figure>

<p>枚举在 switch case 中使用：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aColor = Color.red;</span><br><span class="line"><span class="keyword">switch</span> (aColor) &#123;</span><br><span class="line">  <span class="keyword">case</span> Color.red:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'red'</span>);</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> Color.green:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'green'</span>);</span><br><span class="line">  <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">  <span class="built_in">print</span>(aColor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>枚举类型的局限性：</p>
<ul>
<li>不可子类化，<em>mix in</em>，或实现</li>
<li>不能显示实例一个枚举类型</li>
</ul>
<h3 id="10-11-类添加特性"><a href="#10-11-类添加特性" class="headerlink" title="10.11 类添加特性"></a>10.11 类添加特性</h3><p>Mixins 是一种将类代码共享给其他类的功能。</p>
<p><code>with</code> 关键字<em>使用</em> mixin 功能。例子如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Musician</span> <span class="keyword">extends</span> <span class="title">Performer</span> <span class="title">with</span> <span class="title">Musical</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Maestro</span> <span class="keyword">extends</span> <span class="title">Person</span> <span class="title">with</span> <span class="title">Musical</span>, <span class="title">Aggressive</span>, <span class="title">Demented</span> </span>&#123;</span><br><span class="line">  Maestro(<span class="built_in">String</span> maestroname) &#123;</span><br><span class="line">    name = maestroName;</span><br><span class="line">    canConduct = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>实现</em> mixin：创建一个 Object 子类，并且不声明构造器。另外，如果不想该类被当作普通的类，用 <code>mixin</code> 关键字代替 <code>class</code>。比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mixin Musical &#123;</span><br><span class="line">  <span class="built_in">bool</span> canPlayPiano = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">bool</span> canCompose = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">bool</span> canConduct = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> entertainMe() &#123;</span><br><span class="line">    <span class="keyword">if</span> (canPlayPiano) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'Playing piano'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (canConduct) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'Waving hands'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'Humming to self'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要指定只有某些类型可以使用mixin，使用 <code>on</code> 指定所需的超类：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mixin MusicalPerformer on Musician &#123;</span><br><span class="line">  <span class="comment">// ... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-12-类变量和方法"><a href="#10-12-类变量和方法" class="headerlink" title="10.12 类变量和方法"></a>10.12 类变量和方法</h3><p>使用 <code>static</code> 关键字创建静态变量和方法。静态方法和变量都是面向类型的，实例无法访问。</p>
<h4 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法 "></a>静态方法 <!-- omit in toc --></h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> initialCapacity = <span class="number">16</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">assert</span>(Queue.initialCapacity == <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态变量只有在使用时才会被初始化。</p>
<h4 id="静态方法-1"><a href="#静态方法-1" class="headerlink" title="静态方法 "></a>静态方法 <!-- omit in toc --></h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">num</span> x, y;</span><br><span class="line">  Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">num</span> distanceBetween(Point a, Point b) &#123;</span><br><span class="line">    <span class="keyword">var</span> dx = a.x - b.x;</span><br><span class="line">    <span class="keyword">var</span> dy = a.y - b.y;</span><br><span class="line">    <span class="keyword">return</span> sqrt(dx * dx + dy * dy);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">var</span> a = Point(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">var</span> b = Point(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="keyword">var</span> distance = Point.distanceBetween(a, b);</span><br><span class="line">  <span class="keyword">assert</span>(<span class="number">2.8</span> &lt; distance &amp;&amp; distance &lt; <span class="number">2.9</span>);</span><br><span class="line">  <span class="built_in">print</span>(distance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-泛型"><a href="#11-泛型" class="headerlink" title="11. 泛型"></a>11. 泛型</h2><p>数组类型声明：<code>List&lt;E&gt;</code>，其中 &lt;…&gt; 将类型标记为<em>泛型</em>，即，类型内部有个形式上的参数。通常的命名规范，泛型参数名字为单字符，如 E, T, S, K 和 V。</p>
<h3 id="11-1-为什么使用泛型"><a href="#11-1-为什么使用泛型" class="headerlink" title="11.1 为什么使用泛型"></a>11.1 为什么使用泛型</h3><p>泛型要求代码是类型安全的，但是使用泛型有很多好处：</p>
<ul>
<li>正确使用泛型使代码结构更好</li>
<li>减少重复代码</li>
</ul>
<p>声明一个只含字符串的数组：<code>List&lt;String&gt;</code>。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;();</span><br><span class="line">names.addAll([<span class="string">'Seth'</span>, <span class="string">'Kathy'</span>, <span class="string">'Lars'</span>]);</span><br><span class="line">names.add(<span class="number">42</span>);<span class="comment">//编译报错</span></span><br></pre></td></tr></table></figure>

<p>受益于静态分析的前提下，泛型能为多个类型共享一个接口。比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 缓存 Object</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectCache</span> </span>&#123;</span><br><span class="line">  <span class="built_in">Object</span> getByKey(<span class="built_in">String</span> key);</span><br><span class="line">  <span class="keyword">void</span> setByKey(<span class="built_in">String</span> key, <span class="built_in">Object</span> value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存 String</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">StringCache</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> getByKey(<span class="built_in">String</span> key);</span><br><span class="line">  <span class="keyword">void</span> setByKey(<span class="built_in">String</span> key, <span class="built_in">String</span> value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Cache</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  T getByKey(<span class="built_in">String</span> key);</span><br><span class="line">  <span class="keyword">void</span> setByKey(<span class="built_in">String</span> key, T value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-2-使用集合字面值"><a href="#11-2-使用集合字面值" class="headerlink" title="11.2 使用集合字面值"></a>11.2 使用集合字面值</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = &lt;<span class="built_in">String</span>&gt;[<span class="string">'Seth'</span>, <span class="string">'Kathy'</span>, <span class="string">'Lars'</span>];</span><br><span class="line"><span class="keyword">var</span> uniqueNames = &lt;<span class="built_in">String</span>&gt;&#123;<span class="string">'Seth'</span>, <span class="string">'Kathy'</span>, <span class="string">'Lars'</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> pages = &lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;&#123;</span><br><span class="line">  <span class="string">'index.html'</span>: <span class="string">'Homepage'</span>,</span><br><span class="line">  <span class="string">'robots.txt'</span>: <span class="string">'Hints for web robots'</span>,</span><br><span class="line">  <span class="string">'humans.txt'</span>: <span class="string">'We are people, not machines'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="11-3-使用带参数化类型的构造函数"><a href="#11-3-使用带参数化类型的构造函数" class="headerlink" title="11.3 使用带参数化类型的构造函数"></a>11.3 使用带参数化类型的构造函数</h3><p>使用构造器时，指定一个或多个类型，类型放在 <code>&lt;&gt;</code> 中间。比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nameSet = <span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt;.from(names);</span><br></pre></td></tr></table></figure>

<h3 id="11-4-泛型集合"><a href="#11-4-泛型集合" class="headerlink" title="11.4 泛型集合"></a>11.4 泛型集合</h3><p>Dart 泛型类型是<em>具体化的</em>，这意味着泛型变量在运行时携带类型信息。例子如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> names = <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;();</span><br><span class="line">names.addAll([<span class="string">'Seth'</span>, <span class="string">'Kathy'</span>, <span class="string">'Lars'</span>]);</span><br><span class="line"><span class="built_in">print</span>(names <span class="keyword">is</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="11-5-泛型约束"><a href="#11-5-泛型约束" class="headerlink" title="11.5 泛型约束"></a>11.5 泛型约束</h3><p>当定义泛型，可使用 <code>extends</code> 约束泛型：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">SomeBaseClass</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> toString() =&gt; <span class="string">"Instance of 'Foo&lt;$T&gt;'"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Extender</span> <span class="keyword">extends</span> <span class="title">SomeBaseClass</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> someBaseClassFoo = Foo&lt;SomeBaseClass&gt;();</span><br><span class="line"><span class="keyword">var</span> extenderFoo = Foo&lt;Extender&gt;();</span><br></pre></td></tr></table></figure>

<p>不指定泛型参数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = Foo();</span><br><span class="line"><span class="built_in">print</span>(foo); <span class="comment">// Instance of 'Foo&lt;SomeBaseClass&gt;'</span></span><br></pre></td></tr></table></figure>

<h3 id="11-6-使用泛型方法"><a href="#11-6-使用泛型方法" class="headerlink" title="11.6 使用泛型方法"></a>11.6 使用泛型方法</h3><p>Dart 支持泛型方法或函数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">T first&lt;T&gt;(<span class="built_in">List</span>&lt;T&gt; ts) &#123;</span><br><span class="line">  T tmp = ts[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码展示了函数泛型参数可使用的位置：</p>
<ul>
<li>函数返回值</li>
<li>函数参数</li>
<li>内部布局变量</li>
</ul>
<h2 id="12-库"><a href="#12-库" class="headerlink" title="12. 库"></a>12. 库</h2><p>使用 <code>import</code> 和 <code>library</code> 指令创建模块化和可共享的代码。库不仅提供 APIs，还是私有的作用域块：下划线开头的标识符仅在库内部可见。每个 Dart 应用都是一个库，即使并不使用 <code>library</code> 指令。</p>
<p>库可作为包(package)发布。</p>
<h3 id="12-1-使用库"><a href="#12-1-使用库" class="headerlink" title="12.1 使用库"></a>12.1 使用库</h3><p>使用 <code>import</code>，在一个库中指定另一个库的命名空间。</p>
<p>举个例子，Dart 网页应用通常使用 <code>dart:html</code> 库，可以如下导入：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:html'</span>;</span><br></pre></td></tr></table></figure>

<p><code>import</code> 指令后面的参数是指向目标库的 URI。对于 Dart 自带的库，使用 <code>dart:</code> 作为 sheme。其他库，使用文件路径或 <code>package:</code> scheme。包管理工具提供的库使用 <code>package:</code> scheme。比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:test/test.dart'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="指定库前缀"><a href="#指定库前缀" class="headerlink" title="指定库前缀 "></a>指定库前缀 <!-- omit in toc --></h4><p>当引入的两个库有冲突的标识符，可以为两个库指定前缀，从而避免冲突。例子如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:lib1/lib1.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:lib2/lib2.dart'</span> <span class="keyword">as</span> lib2;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Element</span> element1 = <span class="built_in">Element</span>();</span><br><span class="line"></span><br><span class="line">lib2.<span class="built_in">Element</span> element2 = lib2.<span class="built_in">Element</span>();</span><br></pre></td></tr></table></figure>

<h4 id="导入库的部分接口"><a href="#导入库的部分接口" class="headerlink" title="导入库的部分接口 "></a>导入库的部分接口 <!-- omit in toc --></h4><p>Dart 支持导入库的部分功能，比如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:lib1/lib1.dart'</span> show foo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:lib2/lib2.dart'</span> hide foo;</span><br></pre></td></tr></table></figure>

<h4 id="库懒加载"><a href="#库懒加载" class="headerlink" title="库懒加载 "></a>库懒加载 <!-- omit in toc --></h4><p>库的按需加载。以下场景可以使用库按需加载：</p>
<ul>
<li>加快应用启动时间</li>
<li>A/B test</li>
<li>加载较少使用的库</li>
</ul>
<p>实现懒加载，首先要用 <code>deferred as</code> 导入：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:greetings/hello.dart'</span> deferred <span class="keyword">as</span> hello;</span><br></pre></td></tr></table></figure>

<p>需要使用的地方，用库的标识调用 <code>loadLibrary()</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Future greet() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> hello.loadLibrary();</span><br><span class="line">  hello.printGreeting();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码中，<code>await</code> 关键字会阻塞代码直到库加载完成。更多信息查看<a href="https://dart.dev/guides/language/language-tour#asynchrony-support" target="_blank" rel="noopener">异步操作</a>。</p>
<p>多次调用 <code>loadLibrary()</code> 加载同一个库不会出错，且库只会被加载一次。</p>
<p>使用库的懒加载时，记住以下几点：</p>
<ul>
<li>懒加载的库中的常量，只有在懒加载完成后才能作为常量使用</li>
<li>不能使用懒加载库中的类型。而应该将接口类型放到第三方库中，让目标库和当前文件共同导入第三方库</li>
<li>开发者用 <code>deferred as namespace</code> 定义懒加载库的命名空间，Dart 在命名空间后面隐式插入 <code>loadLibrary()</code>。<code>loadLibrary()</code> 返回 <em>Future</em>。</li>
</ul>
<h3 id="12-2-实现库"><a href="#12-2-实现库" class="headerlink" title="12.2 实现库"></a>12.2 实现库</h3><p>实现一个库，请查看 <a href="https://dart.dev/guides/libraries/create-library-packages" target="_blank" rel="noopener">Create Library Package</a>：</p>
<ul>
<li>如何组织库的源码</li>
<li>如何使用 <code>export</code> 指令</li>
<li>何时使用 <code>part</code> 指令</li>
<li>何时使用 <code>library</code> 指令</li>
</ul>
<h2 id="13-异步"><a href="#13-异步" class="headerlink" title="13. 异步"></a>13. 异步</h2><p>Dart 库中有很多返回值为 <code>Future</code> 和 <code>Stream</code> 的函数。这些函数是异步函数：派发一个耗时任务后直接返回，并不等待任务完成。</p>
<p><code>async</code> 和 <code>await</code> 关键字实现异步编程，让异步任务像同步的代码顺序执行。</p>
<h3 id="13-1-处理-Future"><a href="#13-1-处理-Future" class="headerlink" title="13.1 处理 Future"></a>13.1 处理 Future</h3><p>两种方式处理 Future：</p>
<ul>
<li>使用 <code>async</code> 和 <code>await</code></li>
<li>使用 Future API，查看 <a href="https://dart.dev/guides/libraries/library-tour#future" target="_blank" rel="noopener">the library tour</a></li>
</ul>
<p><code>async</code> 和 <code>await</code> 使用：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> lookUpVersion();</span><br></pre></td></tr></table></figure>

<p>使用 <code>await</code> 的代码，必须要写在 <em>async</em> 函数内：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Future checkVersion() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> version = <span class="keyword">await</span> lookUpVersion();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>try</code>, <code>catch</code> 和 <code>finally</code> 用于处理 <code>await</code> 代码中的错误并执行清理代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  version = <span class="keyword">await</span> lookUpVersion();</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个异步函数中，可使用多个 <code>await</code>，下述代码中，使用了三个 await 处理任务：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> entrypoint = <span class="keyword">await</span> findEntrypoint();</span><br><span class="line"><span class="keyword">var</span> exitCode = <span class="keyword">await</span> runExecutable(entrypoint, args);</span><br><span class="line"><span class="keyword">await</span> flushThenExit(exitCode);</span><br></pre></td></tr></table></figure>

<p>在 <code>await expr</code> 中，<code>expr</code> 的值通常是 Future，如果不是，系统会自动用 Future 包装。该 Future 对象表示一个会返回对象的 promise。<code>await expr</code> 的值就是最终返回的对象。Await 表达式会阻塞代码直到返回最终的对象。</p>
<p><strong>使用 <code>await</code> 的时候报了编译错误，确保 <code>await</code> 实在异步函数中。</strong> 比如，想在 <code>main()</code> 函数中使用 <code>await</code>，那么函数体必须标记为 <code>async</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Future main() <span class="keyword">async</span> &#123;</span><br><span class="line">  checkVersion();</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'In main: version is <span class="subst">$&#123;await lookUpVersion()&#125;</span>'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-2-声明异步函数"><a href="#13-2-声明异步函数" class="headerlink" title="13.2 声明异步函数"></a>13.2 声明异步函数</h3><p>异步函数的函数体用 <code>async</code> 标记。</p>
<p>为函数添加 <code>async</code> 关键字，使得函数返回 Future。如下例子：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> lookUpVersion() =&gt; <span class="string">'1.0.0'</span>;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">String</span>&gt; lookUpVersion() <span class="keyword">async</span> =&gt; <span class="string">'1.0.0'</span>;</span><br></pre></td></tr></table></figure>

<p>从上述代码可知，Dart 自动用 Future 包装返回值。</p>
<p>如果函数没有实际返回值，就返回 <code>Future&lt;void&gt;</code>。</p>
<h3 id="13-3-处理流"><a href="#13-3-处理流" class="headerlink" title="13.3 处理流"></a>13.3 处理流</h3><p>两种方式从流(Stream)中获取值：</p>
<ul>
<li>用 <code>async</code> 和 <em>asynchronous for loop</em>(<code>await for</code>)</li>
<li>使用 <a href="https://dart.dev/guides/libraries/library-tour#stream" target="_blank" rel="noopener">Stream API</a></li>
</ul>
<p>异步循环格式：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="keyword">for</span> (varOrType identifier <span class="keyword">in</span> expression) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码中，<code>expression</code> 必须是 Stream 类型。代码执行顺序：</p>
<ol>
<li>等待流释放一个值</li>
<li>变量被赋值为 (1) 释放的值，并执行循环体</li>
<li>重复步骤(1), (2)，直到流被关闭</li>
</ol>
<p>使用 <code>break</code> 或 <code>return</code> 停止监听流，执行命令后会跳出循环并对流取消订阅</p>
<p><strong>当实现一个异步循环的时候，报编译错误，确保 <code>await for</code> 代码实在异步函数中。</strong> 比如，在 <code>main()</code> 函数中使用异步循环，将 <code>main()</code> 函数体标记为 <code>async</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Future main() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">for</span> (<span class="keyword">var</span> request <span class="keyword">in</span> requestServer) &#123;</span><br><span class="line">    handleRequest(request);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更多异步编程信息，查看 <a href="https://dart.dev/guides/libraries/library-tour#dartasync---asynchronous-programming" target="_blank" rel="noopener"><em>dart:async</em></a>。</p>
<h2 id="14-生成器"><a href="#14-生成器" class="headerlink" title="14. 生成器"></a>14. 生成器</h2><p>用 <em>生成器函数</em> 惰性生成一些列值。Dart 自带两种生成器：</p>
<ul>
<li><strong>Synchronous</strong> 生成器：返回一个 <a href="https://api.dart.dev/stable/dart-core/Iterable-class.html" target="_blank" rel="noopener"><em>Iterable</em></a> 对象</li>
<li><strong>Asynchronous</strong> 生成器：返回一个 <a href="https://api.dart.dev/stable/dart-async/Stream-class.html" target="_blank" rel="noopener"><em>Stream</em></a> 对象</li>
</ul>
<p>实现 <strong>synchronous</strong> 生成器函数方法：用 <code>sync*</code> 标记函数体，并用 <code>yield</code> 语句发送值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Iterable</span>&lt;Int&gt; naturalTo(<span class="built_in">int</span> n) <span class="keyword">sync</span>* &#123;</span><br><span class="line">  <span class="built_in">int</span> k = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (k &lt; n) &#123;</span><br><span class="line">    <span class="keyword">yield</span> k++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现 <strong>asynchronous</strong> 生成器函数方法：用 <code>async*</code> 标记函数体，并用 <code>yield</code> 发送值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Int&gt; asynchronousNaturalTo(<span class="built_in">int</span> n) <span class="keyword">async</span>* &#123;</span><br><span class="line">  <span class="built_in">int</span> k = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (k &lt; n) &#123;</span><br><span class="line">    <span class="keyword">yield</span> k++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>递归生成器，用 <code>yield*</code> 改进性能：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Iterable</span>&lt;Int&gt; naturalsDownFrom(<span class="built_in">int</span> n) <span class="keyword">sync</span>* &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> n;</span><br><span class="line">    <span class="keyword">yield</span>* naturalsDownFrom(n - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="15-可调用的类"><a href="#15-可调用的类" class="headerlink" title="15. 可调用的类"></a>15. 可调用的类</h2><p>类实现 <code>call()</code> 方法后，该类的实例可以像函数一样被调用。</p>
<p>如下例子，<code>WannabeFunction</code> 类实现了 call() 函数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WannabeFunction</span> </span>&#123;</span><br><span class="line">  call(<span class="built_in">String</span> a, <span class="built_in">String</span> b, <span class="built_in">String</span> c) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'$a $b $c!'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">  <span class="keyword">var</span> wf = <span class="keyword">new</span> WannabeFunction();</span><br><span class="line">  <span class="keyword">var</span> out = wf(<span class="string">'Hi'</span>, <span class="string">'there'</span>, <span class="string">'gang'</span>);</span><br><span class="line">  <span class="built_in">print</span>(out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="16-独立性"><a href="#16-独立性" class="headerlink" title="16. 独立性"></a>16. 独立性</h2><p>多数计算机包括手机都有多核 CPU。开发者通常用共享内存的线程并发执行程序，以提高 CPU 利用率。然而，共享状态的并发执行更易出错，也使得代码更加复杂。</p>
<p>Dart 用 <em>isolate</em> 替代线程。每个 isolate 有自己的堆内存，以确保 isolates 之间不会共享状态。</p>
<p>更多信息查看 <a href="https://api.dart.dev/stable/dart-isolate" target="_blank" rel="noopener">dart:isolate library document</a>。</p>
<h2 id="17-类型定义"><a href="#17-类型定义" class="headerlink" title="17. 类型定义"></a>17. 类型定义</h2><p>Dart 中，函数同字符串和数值一样都是对象。<em>Typedef</em> 或者说 <em>funtion-type alias</em> 给函数定义个名字，在其它地方使用。类型定义会保留类型信息。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SortedCollection</span> </span>&#123;</span><br><span class="line">  <span class="built_in">Function</span> compare;</span><br><span class="line"></span><br><span class="line">  SortedCollection(<span class="built_in">Function</span> f) &#123;</span><br><span class="line">    compare = f;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> sort(<span class="built_in">Object</span> a, <span class="built_in">Object</span> b) =&gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main &#123;</span><br><span class="line">  SortedCollection coll = SortedCollection(sort);</span><br><span class="line">  <span class="built_in">print</span>(coll.compare <span class="keyword">is</span> <span class="built_in">Function</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用类型定义后：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Compare = <span class="built_in">int</span> <span class="built_in">Function</span>(<span class="built_in">Object</span> a, <span class="built_in">Object</span> b);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SortedCollection</span> </span>&#123;</span><br><span class="line">  Compare compare;</span><br><span class="line"></span><br><span class="line">  SortedCollection(<span class="keyword">this</span>.compare);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> sort(<span class="built_in">Object</span> a, <span class="built_in">Object</span> b) =&gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">main &#123;</span><br><span class="line">  SortedCollection coll = SortedCollection(sort);</span><br><span class="line">  <span class="built_in">print</span>(coll.compare <span class="keyword">is</span> <span class="built_in">Function</span>); <span class="comment">// true</span></span><br><span class="line">  <span class="built_in">print</span>(coll.compare <span class="keyword">is</span> Compare); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类型定义结合泛型：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Compare&lt;T&gt; = <span class="built_in">int</span> <span class="built_in">Function</span>(T a, Tb);</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> sort(<span class="built_in">int</span> a, <span class="built_in">int</span> b) =&gt; a - b;</span><br><span class="line"></span><br><span class="line">main &#123;</span><br><span class="line">  <span class="built_in">print</span>(sort <span class="keyword">is</span> Compare&lt;Int&gt;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="18-元数据"><a href="#18-元数据" class="headerlink" title="18. 元数据"></a>18. 元数据</h2><p>元数据标注写法：<code>@</code> 开头，后跟着编译期常量或者常量构造器。</p>
<p>Dart 中两种标注对所有代码使用: <code>@deprecated</code> 和 <code>override</code>。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Television</span> </span>&#123;</span><br><span class="line">  <span class="meta">@deprecated</span></span><br><span class="line">  <span class="keyword">void</span> activate &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义元数据标注：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span> todo;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Todo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> who;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> what;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Todo(<span class="keyword">this</span>.who, <span class="keyword">this</span>.what);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用自定义的元数据：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'todo.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Todo</span>(<span class="string">'seth'</span>, <span class="string">'make this do something'</span>)</span><br><span class="line"><span class="keyword">void</span> doSomething() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>元数据可以出现在以下指令前：库，类，类型定义，类型参数，构造器，工厂方法，字段，参数，变量声明，导入导出。运行时可通过 reflection 获取元数据。</p>
<h2 id="19-注释"><a href="#19-注释" class="headerlink" title="19. 注释"></a>19. 注释</h2><p>Dart 支持单行、多行和文档注释。</p>
<h2 id="20-小结"><a href="#20-小结" class="headerlink" title="20. 小结"></a>20. 小结</h2><p>此文档摘录了 Dart 中较为通用的特性。此外，更多新特性正在开发，尽量兼容当前代码。下一步：<a href="https://dart.dev/guides/language/spec" target="_blank" rel="noopener">language specification</a> 和 <a href="https://dart.dev/guides/language/effective-dart" target="_blank" rel="noopener">Effective Dart</a>。</p>
<p>了解更多关于 Dart 核心库，查看 <a href="https://dart.dev/guides/libraries/library-tour" target="_blank" rel="noopener">A Tour of the Dart Libraries</a>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kaynewbie.github.io/2019/07/24/A-tour-of-the-dart-language/" data-id="cjyn1v7cx0008cnxp3bain618" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dart/">dart</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flutter/">flutter</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/07/27/address-sanitizer/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          用 Address Sanitizer 调试内存问题
        
      </div>
    </a>
  
  
    <a href="/2019/07/21/cell_高度自适应/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LLVM/">LLVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/address-sanitizer/">address-sanitizer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/buffer-overflow/">buffer-overflow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dart/">dart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flutter/">flutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/">ios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memory-error/">memory-error</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C-C/" style="font-size: 10px;">C/C++</a> <a href="/tags/LLVM/" style="font-size: 10px;">LLVM</a> <a href="/tags/address-sanitizer/" style="font-size: 10px;">address-sanitizer</a> <a href="/tags/buffer-overflow/" style="font-size: 10px;">buffer-overflow</a> <a href="/tags/dart/" style="font-size: 20px;">dart</a> <a href="/tags/flutter/" style="font-size: 20px;">flutter</a> <a href="/tags/ios/" style="font-size: 10px;">ios</a> <a href="/tags/memory-error/" style="font-size: 10px;">memory-error</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/07/28/flutter-for-ios-developers/">iOS 开发者入坑 Flutter 知识迁移(译)</a>
          </li>
        
          <li>
            <a href="/2019/07/27/address-sanitizer/">用 Address Sanitizer 调试内存问题</a>
          </li>
        
          <li>
            <a href="/2019/07/24/A-tour-of-the-dart-language/">Dart 入门 (译)</a>
          </li>
        
          <li>
            <a href="/2019/07/21/cell_高度自适应/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/07/21/lldb/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Kai<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>